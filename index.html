<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º - Kurs Y√∂netim Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a5276;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #ecf0f1;
            --dark-text: #2c3e50;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-logo img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--white);
            padding: 5px;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-title p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .header-date {
            text-align: right;
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav-container {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 0.5rem 2rem;
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: var(--light-bg);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            background: var(--secondary-color);
            color: var(--white);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: var(--white);
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-bg);
        }

        .card-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--white);
        }

        .btn-danger {
            background: var(--accent-color);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: var(--white);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary-color);
            color: var(--white);
            font-weight: 500;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f5f6fa;
        }

        /* Calendar */
        .calendar-container {
            overflow-x: auto;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 0.75rem;
            text-align: center;
            font-weight: 500;
        }

        .calendar-day {
            background: var(--white);
            min-height: 120px;
            padding: 0.5rem;
            position: relative;
        }

        .calendar-day.other-month {
            background: #f5f6fa;
            opacity: 0.5;
        }

        .calendar-day.weekend {
            background: #ffeaa7;
        }

        .calendar-day.holiday {
            background: #fab1a0;
        }

        .calendar-day.today {
            border: 3px solid var(--secondary-color);
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .day-events {
            font-size: 0.75rem;
        }

        .event-item {
            background: var(--secondary-color);
            color: var(--white);
            padding: 2px 6px;
            border-radius: 3px;
            margin-bottom: 2px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .event-item:hover {
            background: var(--primary-color);
        }

        /* Weekly Schedule */
        .weekly-schedule {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            background: #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .schedule-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .schedule-time {
            background: var(--light-bg);
            padding: 0.5rem;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .schedule-cell {
            background: var(--white);
            min-height: 60px;
            padding: 0.25rem;
            position: relative;
        }

        .schedule-cell.weekend {
            background: #ffeaa7;
        }

        .schedule-event {
            background: var(--secondary-color);
            color: var(--white);
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 2px;
            cursor: pointer;
        }

        .schedule-event:hover {
            background: var(--primary-color);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 4px solid var(--secondary-color);
        }

        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .stat-card p {
            color: #7f8c8d;
            margin-top: 0.5rem;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #ddd;
            background: var(--primary-color);
            color: var(--white);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--white);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 0.25rem;
        }

        .tag-blue { background: #3498db; color: white; }
        .tag-green { background: #27ae60; color: white; }
        .tag-red { background: #e74c3c; color: white; }
        .tag-yellow { background: #f1c40f; color: #333; }
        .tag-purple { background: #9b59b6; color: white; }

        /* Search & Filter */
        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover,
        .color-option.selected {
            border-color: var(--dark-text);
            transform: scale(1.1);
        }

        /* Print Styles */
        @media print {
            .header, .nav-container, .btn, .no-print {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .header-date {
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            
            .nav-tab {
                white-space: nowrap;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-day {
                min-height: 80px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-text);
            color: var(--white);
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Holiday Badge */
        .holiday-badge {
            background: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        /* Checkbox Toggle */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            border-radius: 26px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--success-color);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        /* Workshop Colors */
        .workshop-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 3000;
        }

        .notification {
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.error {
            background: var(--accent-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }
        /* Live Lessons Panel */
        .live-lessons-panel {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            border: 1px dashed #dcdde1;
            margin-bottom: 0.5rem;
        }

        .live-lessons-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .live-lessons-item:last-child {
            border-bottom: none;
        }

        .live-lessons-title {
            font-weight: 600;
            margin-bottom: 0.15rem;
        }

        .live-lessons-meta {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .live-lessons-status {
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            padding: 0.15rem 0.6rem;
            border-radius: 999px;
            margin-bottom: 0.25rem;
        }

        .live-now {
            background: rgba(39, 174, 96, 0.12);
            color: #27ae60;
        }

        .live-upcoming {
            background: rgba(243, 156, 18, 0.12);
            color: #f39c12;
        }
        
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-logo">
            <div style="width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary-color);">
                √áB
            </div>
            <div class="header-title">
                <h1>√áe≈üme Belediyesi</h1>
                <p>K√ºlt√ºr M√ºd√ºrl√ºƒü√º - Kurs Y√∂netim Sistemi</p>
            </div>
        </div>
        <div class="header-date">
            <div id="currentDate"></div>
            <div id="currentTime"></div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard', this)">
                üìä G√∂sterge Paneli
            </button>
            <button class="nav-tab" onclick="showTab('schedule', this)">
                üìÖ Program
            </button>
            <button class="nav-tab" onclick="showTab('courses', this)">
                üìö Kurslar
            </button>
            <button class="nav-tab" onclick="showTab('workshops', this)">
                üè¢ At√∂lyeler
            </button>
            <button class="nav-tab" onclick="showTab('teachers', this)">
                üë®‚Äçüè´ Eƒüitmenler
            </button>
            <button class="nav-tab" onclick="showTab('students', this)">
                üë®‚Äçüéì √ñƒürenciler
            </button>
            <button class="nav-tab" onclick="showTab('holidays', this)">
                üéå Tatiller
            </button>
            <button class="nav-tab" onclick="showTab('reports', this)">
                üìà Raporlar
            </button>
            <button class="nav-tab" onclick="showTab('settings', this)">
                ‚öôÔ∏è Ayarlar
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Notification Container -->
        <div class="notification-container" id="notificationContainer"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalCourses">0</h3>
                    <p>Aktif Kurs</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalWorkshops">0</h3>
                    <p>At√∂lye</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalTeachers">0</h3>
                    <p>Eƒüitmen</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalStudents">0</h3>
                    <p>√ñƒürenci</p>
                </div>
                <div class="stat-card">
                    <h3 id="weeklyLessons">0</h3>
                    <p>Haftalƒ±k Ders</p>
                </div>
                <div class="stat-card">
                    <h3 id="upcomingHolidays">0</h3>
                    <p>Yakla≈üan Tatil</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Bu Haftanƒ±n Programƒ±</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm" onclick="showTab('schedule', this)">T√ºm Programƒ± G√∂r</button>
                    </div>
                </div>
                <div id="weeklyOverview"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üîî Bug√ºn√ºn Dersleri</h2>
                </div>
                <div id="liveLessonsPanel" style="margin-bottom: 0.75rem;"></div>
                <div id="todayLessons"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üéå Yakla≈üan Tatiller</h2>
                </div>
                <div id="upcomingHolidaysList"></div>
            </div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Ders Programƒ±</h2>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="openScheduleModal()">+ Yeni Ders Ekle</button>
                        <button class="btn btn-secondary" onclick="toggleView()">G√∂r√ºn√ºm√º Deƒüi≈ütir</button>
                    </div>
                </div>

                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="btn btn-sm btn-secondary" onclick="changeMonth(-1)">‚óÄ √ñnceki</button>
                        <h3 id="currentMonthYear"></h3>
                        <button class="btn btn-sm btn-secondary" onclick="changeMonth(1)">Sonraki ‚ñ∂</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-primary" onclick="goToToday()">Bug√ºn</button>
                        <select id="workshopFilter" onchange="filterSchedule()">
                            <option value="">T√ºm At√∂lyeler</option>
                        </select>
                        <select id="teacherFilter" onchange="filterSchedule()">
                            <option value="">T√ºm Eƒüitmenler</option>
                        </select>
                    </div>
                </div>

                <div id="calendarView" class="calendar-container"></div>
                <div id="weeklyView" class="calendar-container" style="display:none;"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Ders Listesi</h2>
                </div>
                <div class="search-filter">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="scheduleSearch" placeholder="Ders ara..." onkeyup="searchSchedule()">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>G√ºn</th>
                                <th>Saat</th>
                                <th>Kurs</th>
                                <th>Eƒüitmen</th>
                                <th>At√∂lye</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Courses Tab -->
        <div id="courses" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìö Kurs Y√∂netimi</h2>
                    <button class="btn btn-success" onclick="openCourseModal()">+ Yeni Kurs Ekle</button>
                </div>
                <div class="search-filter">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="courseSearch" placeholder="Kurs ara..." onkeyup="searchCourses()">
                    </div>
                    <select id="courseCategory" onchange="filterCourses()">
                        <option value="">T√ºm Kategoriler</option>
                    </select>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Kurs Adƒ±</th>
                                <th>Kategori</th>
                                <th>S√ºre</th>
                                <th>Kapasite</th>
                                <th>Kayƒ±tlƒ±</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="coursesTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Workshops Tab -->
        <div id="workshops" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè¢ At√∂lye Y√∂netimi</h2>
                    <button class="btn btn-success" onclick="openWorkshopModal()">+ Yeni At√∂lye Ekle</button>
                </div>
                <div class="search-filter">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="workshopSearch" placeholder="At√∂lye ara..." onkeyup="searchWorkshops()">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Renk</th>
                                <th>At√∂lye Adƒ±</th>
                                <th>Konum</th>
                                <th>Kapasite</th>
                                <th>Donanƒ±m</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="workshopsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Teachers Tab -->
        <div id="teachers" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üë®‚Äçüè´ Eƒüitmen Y√∂netimi</h2>
                    <button class="btn btn-success" onclick="openTeacherModal()">+ Yeni Eƒüitmen Ekle</button>
                </div>
                <div class="search-filter">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="teacherSearch" placeholder="Eƒüitmen ara..." onkeyup="searchTeachers()">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ad Soyad</th>
                                <th>Bran≈ü</th>
                                <th>Telefon</th>
                                <th>E-posta</th>
                                <th>Ders Sayƒ±sƒ±</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üë®‚Äçüéì √ñƒürenci Y√∂netimi</h2>
                    <button class="btn btn-success" onclick="openStudentModal()">+ Yeni √ñƒürenci Ekle</button>
                </div>
                <div class="search-filter">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="studentSearch" placeholder="√ñƒürenci ara..." onkeyup="searchStudents()">
                    </div>
                    <select id="studentCourse" onchange="filterStudents()">
                        <option value="">T√ºm Kurslar</option>
                    </select>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ad Soyad</th>
                                <th>TC Kimlik</th>
                                <th>Telefon</th>
                                <th>Kayƒ±tlƒ± Kurslar</th>
                                <th>Kayƒ±t Tarihi</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Holidays Tab -->
        <div id="holidays" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üéå Resmi Tatil Y√∂netimi</h2>
                    <button class="btn btn-success" onclick="openHolidayModal()">+ Yeni Tatil Ekle</button>
                </div>
                <div class="alert alert-info">
                    ‚ÑπÔ∏è Hafta sonlarƒ± (Cumartesi-Pazar) otomatik olarak i≈üaretlenir. Yinelenen resmi tatiller her yƒ±l otomatik hesaplanƒ±r.
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tatil Adƒ±</th>
                                <th>Ba≈ülangƒ±√ß</th>
                                <th>Biti≈ü</th>
                                <th>Yinelenen</th>
                                <th>A√ßƒ±klama</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="holidaysTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Yƒ±llƒ±k Tatil Takvimi</h2>
                </div>
                <div id="yearlyHolidayCalendar"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìà Raporlar</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Rapor T√ºr√º</label>
                        <select id="reportType" onchange="updateReportOptions()">
                            <option value="course">Kurs Raporu</option>
                            <option value="teacher">Eƒüitmen Raporu</option>
                            <option value="workshop">At√∂lye Kullanƒ±m Raporu</option>
                            <option value="student">√ñƒürenci Raporu</option>
                            <option value="schedule">Haftalƒ±k Program Raporu</option>
                            <option value="attendance">Devam Durumu Raporu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tarih Aralƒ±ƒüƒ±</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="date" id="reportStartDate">
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>
                    <div class="form-group" id="reportFilterGroup">
                        <label>Filtre</label>
                        <select id="reportFilter">
                            <option value="">T√ºm√º</option>
                        </select>
                    </div>
                </div>
                <div class="btn-group" style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="generateReport()">üìä Rapor Olu≈ütur</button>
                    <button class="btn btn-success" onclick="exportReport('excel')">üì• Excel ƒ∞ndir</button>
                    <button class="btn btn-secondary" onclick="exportReport('pdf')">üìÑ PDF ƒ∞ndir</button>
                    <button class="btn btn-warning" onclick="printReport()">üñ®Ô∏è Yazdƒ±r</button>
                </div>
            </div>

            <div class="card" id="reportResult" style="display:none;">
                <div class="card-header">
                    <h2 class="card-title" id="reportTitle">Rapor Sonu√ßlarƒ±</h2>
                    <span id="reportDate"></span>
                </div>
                <div id="reportContent"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚öôÔ∏è Sistem Ayarlarƒ±</h2>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Kurum Adƒ±</label>
                        <input type="text" id="settingOrgName" value="√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º">
                    </div>
                    <div class="form-group">
                        <label>√áalƒ±≈üma Saatleri Ba≈ülangƒ±√ß</label>
                        <input type="time" id="settingStartTime" value="09:00">
                    </div>
                    <div class="form-group">
                        <label>√áalƒ±≈üma Saatleri Biti≈ü</label>
                        <input type="time" id="settingEndTime" value="21:00">
                    </div>
                    <div class="form-group">
                        <label>Ders S√ºresi (dakika)</label>
                        <input type="number" id="settingLessonDuration" value="60">
                    </div>
                    <div class="form-group">
                        <label>Ders Arasƒ± (dakika)</label>
                        <input type="number" id="settingBreakDuration" value="15">
                    </div>
                    <div class="form-group">
                        <label>Hafta Sonu Tatil</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingWeekendOff" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÇ Kategori Y√∂netimi</h2>
                    <button class="btn btn-success btn-sm" onclick="openCategoryModal()">+ Yeni Kategori</button>
                </div>
                <div id="categoriesList"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üíæ Veri Y√∂netimi</h2>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportAllData()">üì§ Verileri Dƒ±≈üa Aktar</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• Verileri ƒ∞√ße Aktar</button>
                    <input type="file" id="importFile" style="display:none" accept=".json" onchange="importAllData(event)">
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è T√ºm Verileri Sil</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üé® Tema Ayarlarƒ±</h2>
                </div>
                <div class="form-group">
                    <label>Ana Renk</label>
                    <div class="color-picker" id="themeColorPicker">
                        <div class="color-option selected" style="background: #1a5276;" data-color="#1a5276"></div>
                        <div class="color-option" style="background: #27ae60;" data-color="#27ae60"></div>
                        <div class="color-option" style="background: #8e44ad;" data-color="#8e44ad"></div>
                        <div class="color-option" style="background: #c0392b;" data-color="#c0392b"></div>
                        <div class="color-option" style="background: #d35400;" data-color="#d35400"></div>
                        <div class="color-option" style="background: #16a085;" data-color="#16a085"></div>
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="saveSettings()">üíæ Ayarlarƒ± Kaydet</button>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Schedule Modal -->
    <div class="modal-overlay" id="scheduleModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="scheduleModalTitle">Yeni Ders Ekle</h3>
                <button class="modal-close" onclick="closeModal('scheduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <input type="hidden" id="scheduleId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Kurs *</label>
                            <select id="scheduleCourse" required></select>
                        </div>
                        <div class="form-group">
                            <label>Eƒüitmen *</label>
                            <select id="scheduleTeacher" required></select>
                        </div>
                        <div class="form-group">
                            <label>At√∂lye *</label>
                            <select id="scheduleWorkshop" required></select>
                        </div>
                        <div class="form-group">
                            <label>G√ºn *</label>
                            <select id="scheduleDay" required>
                                <option value="1">Pazartesi</option>
                                <option value="2">Salƒ±</option>
                                <option value="3">√áar≈üamba</option>
                                <option value="4">Per≈üembe</option>
                                <option value="5">Cuma</option>
                                <option value="6">Cumartesi</option>
                                <option value="0">Pazar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Saati *</label>
                            <input type="time" id="scheduleStartTime" required>
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü Saati *</label>
                            <input type="time" id="scheduleEndTime" required>
                        </div>
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Tarihi</label>
                            <input type="date" id="scheduleStartDate">
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü Tarihi</label>
                            <input type="date" id="scheduleEndDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notlar</label>
                        <textarea id="scheduleNotes" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="scheduleActive" checked> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('scheduleModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveSchedule()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Course Modal -->
    <div class="modal-overlay" id="courseModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="courseModalTitle">Yeni Kurs Ekle</h3>
                <button class="modal-close" onclick="closeModal('courseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="courseForm">
                    <input type="hidden" id="courseId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Kurs Adƒ± *</label>
                            <input type="text" id="courseName" required>
                        </div>
                        <div class="form-group">
                            <label>Kategori *</label>
                            <select id="courseCategorySelect" required></select>
                        </div>
                        <div class="form-group">
                            <label>S√ºre (Hafta)</label>
                            <input type="number" id="courseDuration" min="1" value="12">
                        </div>
                        <div class="form-group">
                            <label>Kapasite</label>
                            <input type="number" id="courseCapacity" min="1" value="20">
                        </div>
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Saati *</label>
                            <input type="time" id="courseStartTime" required>
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü Saati *</label>
                            <input type="time" id="courseEndTime" required>
                        </div>
                        <div class="form-group">
                            <label>Ya≈ü Grubu</label>
                            <select id="courseAgeGroup">
                                <option value="child">√áocuk (7-12)</option>
                                <option value="teen">Gen√ß (13-18)</option>
                                <option value="adult">Yeti≈ükin (18+)</option>
                                <option value="senior">65+</option>
                                <option value="all">T√ºm Ya≈ülar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Seviye</label>
                            <select id="courseLevel">
                                <option value="beginner">Ba≈ülangƒ±√ß</option>
                                <option value="intermediate">Orta</option>
                                <option value="advanced">ƒ∞leri</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>A√ßƒ±klama</label>
                        <textarea id="courseDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Gerekli Malzemeler</label>
                        <textarea id="courseMaterials" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="courseActive" checked> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('courseModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveCourse()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Workshop Modal -->
    <div class="modal-overlay" id="workshopModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="workshopModalTitle">Yeni At√∂lye Ekle</h3>
                <button class="modal-close" onclick="closeModal('workshopModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="workshopForm">
                    <input type="hidden" id="workshopId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>At√∂lye Adƒ± *</label>
                            <input type="text" id="workshopName" required>
                        </div>
                        <div class="form-group">
                            <label>Konum</label>
                            <input type="text" id="workshopLocation">
                        </div>
                        <div class="form-group">
                            <label>Kapasite</label>
                            <input type="number" id="workshopCapacity" min="1" value="20">
                        </div>
                        <div class="form-group">
                            <label>Renk</label>
                            <div class="color-picker" id="workshopColorPicker">
                                <div class="color-option selected" style="background: #3498db;" data-color="#3498db"></div>
                                <div class="color-option" style="background: #27ae60;" data-color="#27ae60"></div>
                                <div class="color-option" style="background: #9b59b6;" data-color="#9b59b6"></div>
                                <div class="color-option" style="background: #e74c3c;" data-color="#e74c3c"></div>
                                <div class="color-option" style="background: #f39c12;" data-color="#f39c12"></div>
                                <div class="color-option" style="background: #1abc9c;" data-color="#1abc9c"></div>
                                <div class="color-option" style="background: #e91e63;" data-color="#e91e63"></div>
                                <div class="color-option" style="background: #795548;" data-color="#795548"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Donanƒ±m/√ñzellikler</label>
                        <textarea id="workshopEquipment" rows="3" placeholder="Projeksiyon, Klima, Piyano vb."></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="workshopActive" checked> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('workshopModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveWorkshop()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Teacher Modal -->
    <div class="modal-overlay" id="teacherModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="teacherModalTitle">Yeni Eƒüitmen Ekle</h3>
                <button class="modal-close" onclick="closeModal('teacherModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="teacherForm">
                    <input type="hidden" id="teacherId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ad Soyad *</label>
                            <input type="text" id="teacherName" required>
                        </div>
                        <div class="form-group">
                            <label>TC Kimlik No</label>
                            <input type="text" id="teacherTc" maxlength="11">
                        </div>
                        <div class="form-group">
                            <label>Bran≈ü *</label>
                            <input type="text" id="teacherBranch" required>
                        </div>
                        <div class="form-group">
                            <label>Telefon</label>
                            <input type="tel" id="teacherPhone">
                        </div>
                        <div class="form-group">
                            <label>E-posta</label>
                            <input type="email" id="teacherEmail">
                        </div>
                        <div class="form-group">
                            <label>Adres</label>
                            <input type="text" id="teacherAddress">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notlar</label>
                        <textarea id="teacherNotes" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="teacherActive" checked> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('teacherModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveTeacher()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Student Modal -->
    <div class="modal-overlay" id="studentModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="studentModalTitle">Yeni √ñƒürenci Ekle</h3>
                <button class="modal-close" onclick="closeModal('studentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ad Soyad *</label>
                            <input type="text" id="studentName" required>
                        </div>
                        <div class="form-group">
                            <label>TC Kimlik No *</label>
                            <input type="text" id="studentTc" maxlength="11" required>
                        </div>
                        <div class="form-group">
                            <label>Doƒüum Tarihi</label>
                            <input type="date" id="studentBirthdate">
                        </div>
                        <div class="form-group">
                            <label>Telefon</label>
                            <input type="tel" id="studentPhone">
                        </div>
                        <div class="form-group">
                            <label>E-posta</label>
                            <input type="email" id="studentEmail">
                        </div>
                        <div class="form-group">
                            <label>Adres</label>
                            <input type="text" id="studentAddress">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Kayƒ±tlƒ± Kurslar</label>
                        <div id="studentCoursesCheckboxes"></div>
                    </div>
                    <div class="form-group">
                        <label>Veli Bilgisi (18 ya≈ü altƒ± i√ßin)</label>
                        <input type="text" id="studentGuardian" placeholder="Veli adƒ± ve telefonu">
                    </div>
                    <div class="form-group">
                        <label>Notlar</label>
                        <textarea id="studentNotes" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="studentActive" checked> Aktif
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('studentModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveStudent()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Holiday Modal -->
    <div class="modal-overlay" id="holidayModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="holidayModalTitle">Yeni Tatil Ekle</h3>
                <button class="modal-close" onclick="closeModal('holidayModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="holidayForm">
                    <input type="hidden" id="holidayId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tatil Adƒ± *</label>
                            <input type="text" id="holidayName" required>
                        </div>
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Tarihi *</label>
                            <input type="date" id="holidayStartDate" required>
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü Tarihi *</label>
                            <input type="date" id="holidayEndDate" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="holidayRecurring"> Her yƒ±l tekrarla
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>A√ßƒ±klama</label>
                        <textarea id="holidayDescription" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('holidayModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveHoliday()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Kategori Y√∂netimi</h3>
                <button class="modal-close" onclick="closeModal('categoryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Yeni Kategori Adƒ±</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="newCategoryName">
                        <button class="btn btn-success" onclick="addCategory()">Ekle</button>
                    </div>
                </div>
                <div id="categoryList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('categoryModal')">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="detailModalTitle">Detaylar</h3>
                <button class="modal-close" onclick="closeModal('detailModal')">&times;</button>
            </div>
            <div class="modal-body" id="detailModalContent"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('detailModal')">Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Data Storage ====================
        let data = {
            courses: [],
            workshops: [],
            teachers: [],
            students: [],
            schedules: [],
            holidays: [],
            categories: ['M√ºzik', 'Resim', 'El Sanatlarƒ±', 'Dans', 'Spor', 'Dil', 'Bilgisayar', 'Diƒüer'],
            settings: {
                orgName: '√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º',
                startTime: '09:00',
                endTime: '21:00',
                lessonDuration: 60,
                breakDuration: 15,
                weekendOff: true,
                primaryColor: '#1a5276'
            }
        };

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentView = 'calendar';

        // ==================== Initialize ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeDefaultHolidays();
            updateDateTime();
            setInterval(updateDateTime, 1000);
        setInterval(renderLiveLessonsPanel, 60000);
            renderAll();
            setupColorPickers();
        });

        function loadData() {
            const saved = localStorage.getItem('cesmeKursData');
            if (saved) {
                data = { ...data, ...JSON.parse(saved) };
            }
        }

        function saveData() {
            localStorage.setItem('cesmeKursData', JSON.stringify(data));
        }

        function initializeDefaultHolidays() {
            if (data.holidays.length === 0) {
                data.holidays = [
                    { id: 1, name: 'Yƒ±lba≈üƒ±', startDate: '01-01', endDate: '01-01', recurring: true, description: 'Yeni yƒ±l tatili' },
                    { id: 2, name: 'Ulusal Egemenlik ve √áocuk Bayramƒ±', startDate: '04-23', endDate: '04-23', recurring: true, description: '' },
                    { id: 3, name: 'Emek ve Dayanƒ±≈üma G√ºn√º', startDate: '05-01', endDate: '05-01', recurring: true, description: '' },
                    { id: 4, name: 'Atat√ºrk\'√º Anma, Gen√ßlik ve Spor Bayramƒ±', startDate: '05-19', endDate: '05-19', recurring: true, description: '' },
                    { id: 5, name: 'Demokrasi ve Milli Birlik G√ºn√º', startDate: '07-15', endDate: '07-15', recurring: true, description: '' },
                    { id: 6, name: 'Zafer Bayramƒ±', startDate: '08-30', endDate: '08-30', recurring: true, description: '' },
                    { id: 7, name: 'Cumhuriyet Bayramƒ±', startDate: '10-29', endDate: '10-29', recurring: true, description: '' }
                ];
                saveData();
            }
        }

        // ==================== Utility Functions ====================
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('tr-TR', options);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('tr-TR');
        }

        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function showTab(tabId, trigger = null) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const target = trigger || (typeof event !== 'undefined' ? event.target : null);
            if (target) {
                target.classList.add('active');
            }
            
            if (tabId === 'dashboard') {
                updateDashboard();
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function getDayName(day) {
            const days = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];
            return days[day];
        }

        function parseLocalDate(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.split('-').map(Number);
            if (parts.length !== 3 || parts.some(isNaN)) return null;
            const date = new Date(parts[0], parts[1] - 1, parts[2]);
            date.setHours(0, 0, 0, 0);
            return date;
        }

        function formatDateForInput(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = parseLocalDate(dateStr);
            if (!date) return '-';
            return date.toLocaleDateString('tr-TR');
        }

        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6;
        }

        function isHoliday(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${month}-${day}`;
            const fullDateStr = `${date.getFullYear()}-${month}-${day}`;
            
            return data.holidays.some(h => {
                if (h.recurring) {
                    return dateStr >= h.startDate && dateStr <= h.endDate;
                } else {
                    return fullDateStr >= h.startDate && fullDateStr <= h.endDate;
                }
            });
        }

        function getHolidayName(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${month}-${day}`;
            
            const holiday = data.holidays.find(h => {
                if (h.recurring) {
                    return dateStr >= h.startDate && dateStr <= h.endDate;
                }
                return false;
            });

            return holiday ? holiday.name : '';
        }

        function getNextHolidayDate(holiday, referenceDate = new Date()) {
            if (!holiday) return null;

            const baseYear = referenceDate.getFullYear();

            if (holiday.recurring) {
                let date = new Date(`${baseYear}-${holiday.startDate}`);
                if (isNaN(date)) return null;
                if (date < referenceDate) {
                    date = new Date(`${baseYear + 1}-${holiday.startDate}`);
                }
                return isNaN(date) ? null : date;
            }

            const date = new Date(holiday.startDate);
            if (isNaN(date) || date < referenceDate) return null;
            return date;
        }

        // ==================== Render Functions ====================
        function renderAll() {
            updateDashboard();
            renderCalendar();
            renderScheduleTable();
            renderCoursesTable();
            renderWorkshopsTable();
            renderTeachersTable();
            renderStudentsTable();
            renderHolidaysTable();
            renderCategories();
            populateFilters();
            populateSelectOptions();
        }

        function getScheduleEndDate(schedule) {
            if (schedule.endDate) {
                return parseLocalDate(schedule.endDate);
            }

            const course = data.courses.find(c => c.id === schedule.courseId);
            if (schedule.startDate && course?.duration) {
                const end = parseLocalDate(schedule.startDate);
                if (!end) return null;
                end.setDate(end.getDate() + (course.duration * 7) - 1);
                return end;
            }

            return null;
        }

        function isScheduleActiveOn(schedule, date) {
            const isActive = schedule.active !== false;
            if (!isActive) return false;

            const targetDate = new Date(date);
            targetDate.setHours(0, 0, 0, 0);

            const start = schedule.startDate ? parseLocalDate(schedule.startDate) : null;
            const end = getScheduleEndDate(schedule);

            if (start && targetDate < start) return false;
            if (end && targetDate > end) return false;

            return true;
        }

        function updateDashboard() {
            document.getElementById('totalCourses').textContent = data.courses.filter(c => c.active).length;
            document.getElementById('totalWorkshops').textContent = data.workshops.filter(w => w.active).length;
            document.getElementById('totalTeachers').textContent = data.teachers.filter(t => t.active).length;
            document.getElementById('totalStudents').textContent = data.students.filter(s => s.active).length;
            const now = new Date();
            document.getElementById('weeklyLessons').textContent = data.schedules.filter(s => isScheduleActiveOn(s, now)).length;

            const today = new Date();
            const upcomingHolidays = data.holidays.filter(h => getNextHolidayDate(h, today)).length;
            document.getElementById('upcomingHolidays').textContent = upcomingHolidays;

            renderTodayLessons();
            renderLiveLessonsPanel();
            renderUpcomingHolidays();
            renderWeeklyOverview();
        }

        function renderTodayLessons() {
            const todayDate = new Date();
            const today = todayDate.getDay();
            const todaySchedules = data.schedules.filter(s => isScheduleActiveOn(s, todayDate) && parseInt(s.day) === today);
            
            const container = document.getElementById('todayLessons');
            if (todaySchedules.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d; padding: 1rem;">Bug√ºn ders bulunmamaktadƒ±r.</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Saat</th>
                            <th>Kurs</th>
                            <th>Eƒüitmen</th>
                            <th>At√∂lye</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${todaySchedules.sort((a, b) => a.startTime.localeCompare(b.startTime)).map(s => {
                            const course = data.courses.find(c => c.id === s.courseId);
                            const teacher = data.teachers.find(t => t.id === s.teacherId);
                            const workshop = data.workshops.find(w => w.id === s.workshopId);
                            return `
                                <tr>
                                    <td>${s.startTime} - ${s.endTime}</td>
                                    <td>${course ? course.name : '-'}</td>
                                    <td>${teacher ? teacher.name : '-'}</td>
                                    <td>${workshop ? workshop.name : '-'}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        
        function parseTimeToDate(timeStr, baseDate) {
            if (!timeStr) return null;
            const parts = timeStr.split(':').map(Number);
            if (parts.length < 2 || parts.some(isNaN)) return null;
            const d = new Date(baseDate);
            d.setHours(parts[0], parts[1], 0, 0);
            return d;
        }

        function formatMinuteDiff(totalMinutes) {
            const minutes = Math.round(Math.abs(totalMinutes));
            if (minutes < 1) return 'birka√ß saniye';
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            const parts = [];
            if (hours > 0) parts.push(hours + ' saat');
            if (mins > 0) parts.push(mins + ' dakika');
            return parts.join(' ');
        }

        function renderLiveLessonsPanel() {
            const container = document.getElementById('liveLessonsPanel');
            if (!container) return;

            const now = new Date();
            const today = now.getDay();

            const todaySchedules = data.schedules.filter(s => 
                isScheduleActiveOn(s, now) && parseInt(s.day) === today
            );

            if (todaySchedules.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">Bug√ºn i√ßin planlanmƒ±≈ü ders bulunmamaktadƒ±r.</p>';
                return;
            }

            const items = [];

            todaySchedules.forEach(s => {
                const start = parseTimeToDate(s.startTime, now);
                const end = parseTimeToDate(s.endTime, now);
                if (!start || !end) return;

                const course = data.courses.find(c => c.id === s.courseId);
                const teacher = data.teachers.find(t => t.id === s.teacherId);
                const workshop = data.workshops.find(w => w.id === s.workshopId);

                if (now >= start && now < end) {
                    const diffMinutes = (end - now) / 60000;
                    items.push({
                        sortKey: 0 + start.getTime(),
                        html: '<div class="live-lessons-item">' +
                              '<div class="live-lessons-status live-now">≈ûU AN DEVAM EDƒ∞YOR</div>' +
                              '<div class="live-lessons-title">' + (course ? course.name : 'Bilinmeyen Kurs') + ' (' + s.startTime + ' - ' + s.endTime + ')</div>' +
                              '<div class="live-lessons-meta">Eƒüitmen: ' + (teacher ? teacher.name : '-') + ' ‚Ä¢ At√∂lye: ' + (workshop ? workshop.name : '-') + '</div>' +
                              '<div class="live-lessons-meta" style="color:#27ae60; margin-top:0.15rem;">Biti≈üine ' + formatMinuteDiff(diffMinutes) + ' kaldƒ±.</div>' +
                              '</div>'
                    });
                } else if (start > now) {
                    const diffMinutes = (start - now) / 60000;
                    if (diffMinutes <= 180) { // 3 saat i√ßinde ba≈ülayacak olanlar
                        items.push({
                            sortKey: 1 + start.getTime(),
                            html: '<div class="live-lessons-item">' +
                                  '<div class="live-lessons-status live-upcoming">' + formatMinuteDiff(diffMinutes) + ' sonra ba≈ülayacak</div>' +
                                  '<div class="live-lessons-title">' + (course ? course.name : 'Bilinmeyen Kurs') + ' (' + s.startTime + ' - ' + s.endTime + ')</div>' +
                                  '<div class="live-lessons-meta">Eƒüitmen: ' + (teacher ? teacher.name : '-') + ' ‚Ä¢ At√∂lye: ' + (workshop ? workshop.name : '-') + '</div>' +
                                  '</div>'
                        });
                    }
                }
            });

            items.sort((a, b) => a.sortKey - b.sortKey);

            if (items.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">≈ûu anda devam eden veya yakƒ±nda ba≈ülayacak ders bulunmamaktadƒ±r.</p>';
                return;
            }

            container.innerHTML = '<div class="live-lessons-panel">' +
                                  items.map(i => i.html).join('') +
                                  '</div>';
        }

function renderUpcomingHolidays() {
            const container = document.getElementById('upcomingHolidaysList');
            const today = new Date();

            const upcoming = data.holidays
                .map(h => {
                    const date = getNextHolidayDate(h, today);
                    return date ? { ...h, date } : null;
                })
                .filter(Boolean)
                .sort((a, b) => a.date - b.date)
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d; padding: 0.5rem 0;">Yakla≈üan tatil bulunmuyor.</p>';
                return;
            }

            container.innerHTML = upcoming.map(h => `
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                    <span><span class="holiday-badge">üéå</span> ${h.name}</span>
                    <span>${h.date.toLocaleDateString('tr-TR')}</span>
                </div>
            `).join('');
        }

        function renderWeeklyOverview() {
            const container = document.getElementById('weeklyOverview');
            const days = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
            
            let html = '<div class="weekly-schedule"><div class="schedule-header">Saat</div>';
            days.forEach((day, i) => {
                const dayNum = i === 6 ? 0 : i + 1;
                html += `<div class="schedule-header ${dayNum === 0 || dayNum === 6 ? 'weekend' : ''}">${day}</div>`;
            });

            const times = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'];
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - ((today.getDay() + 6) % 7));
            
            times.forEach(time => {
                html += `<div class="schedule-time">${time}</div>`;
                for (let i = 0; i < 7; i++) {
                    const dayNum = i === 6 ? 0 : i + 1;
                    const isWeekendCell = dayNum === 0 || dayNum === 6;
                    const cellDate = new Date(weekStart);
                    cellDate.setDate(weekStart.getDate() + i);
                    const schedules = data.schedules.filter(s =>
                        isScheduleActiveOn(s, cellDate) &&
                        parseInt(s.day) === dayNum &&
                        s.startTime <= time &&
                        s.endTime > time
                    );
                    
                    html += `<div class="schedule-cell ${isWeekendCell ? 'weekend' : ''}">`;
                    schedules.forEach(s => {
                        const course = data.courses.find(c => c.id === s.courseId);
                        const workshop = data.workshops.find(w => w.id === s.workshopId);
                        const color = workshop ? workshop.color : '#3498db';
                        html += `<div class="schedule-event" style="background: ${color};" onclick="showScheduleDetail('${s.id}')">${course ? course.name : 'Ders'}</div>`;
                    });
                    html += '</div>';
                }
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // ==================== Calendar ====================
        function renderCalendar() {
            const container = document.getElementById('calendarView');
            const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            document.getElementById('currentMonthYear').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7;
            const today = new Date();
            
            let html = '<div class="calendar-grid">';
            const dayNames = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            dayNames.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });

            // Previous month days
            const prevMonth = new Date(currentYear, currentMonth, 0);
            for (let i = startDay - 1; i >= 0; i--) {
                const day = prevMonth.getDate() - i;
                html += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
            }

            // Current month days
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(currentYear, currentMonth, day);
                const isToday = date.toDateString() === today.toDateString();
                const isWeekendDay = isWeekend(date);
                const isHolidayDay = isHoliday(date);
                const dayOfWeek = date.getDay();

                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isWeekendDay) classes += ' weekend';
                if (isHolidayDay) classes += ' holiday';

                const daySchedules = data.schedules.filter(s => isScheduleActiveOn(s, date) && parseInt(s.day) === dayOfWeek);
                
                html += `<div class="${classes}">
                    <div class="day-number">${day}</div>`;
                
                if (isHolidayDay) {
                    html += `<div style="font-size: 0.7rem; color: #c0392b;">${getHolidayName(date)}</div>`;
                }
                
                html += '<div class="day-events">';
                daySchedules.slice(0, 3).forEach(s => {
                    const course = data.courses.find(c => c.id === s.courseId);
                    const workshop = data.workshops.find(w => w.id === s.workshopId);
                    const color = workshop ? workshop.color : '#3498db';
                    html += `<div class="event-item" style="background: ${color};" onclick="showScheduleDetail('${s.id}')">${s.startTime} ${course ? course.name.substring(0, 10) : ''}</div>`;
                });
                if (daySchedules.length > 3) {
                    html += `<div style="font-size: 0.7rem; color: #666;">+${daySchedules.length - 3} ders daha</div>`;
                }
                html += '</div></div>';
            }

            // Next month days
            const remainingDays = 42 - (startDay + lastDay.getDate());
            for (let day = 1; day <= remainingDays; day++) {
                html += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
        }

        function toggleView() {
            const calendarView = document.getElementById('calendarView');
            const weeklyView = document.getElementById('weeklyView');
            
            if (currentView === 'calendar') {
                calendarView.style.display = 'none';
                weeklyView.style.display = 'block';
                currentView = 'weekly';
                renderWeeklyView();
            } else {
                calendarView.style.display = 'block';
                weeklyView.style.display = 'none';
                currentView = 'calendar';
            }
        }

        function renderWeeklyView() {
            const container = document.getElementById('weeklyView');
            const days = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
            
            let html = '<div class="weekly-schedule"><div class="schedule-header">Saat</div>';
            days.forEach((day, i) => {
                const dayNum = i === 6 ? 0 : i + 1;
                const isWeekendDay = dayNum === 0 || dayNum === 6;
                html += `<div class="schedule-header" style="${isWeekendDay ? 'background: #d4ac0d;' : ''}">${day}</div>`;
            });

            const startHour = parseInt(data.settings.startTime.split(':')[0]);
            const endHour = parseInt(data.settings.endTime.split(':')[0]);
            
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - ((today.getDay() + 6) % 7));

            for (let hour = startHour; hour < endHour; hour++) {
                const time = `${String(hour).padStart(2, '0')}:00`;
                html += `<div class="schedule-time">${time}</div>`;

                for (let i = 0; i < 7; i++) {
                    const dayNum = i === 6 ? 0 : i + 1;
                    const isWeekendDay = dayNum === 0 || dayNum === 6;
                    const cellDate = new Date(weekStart);
                    cellDate.setDate(weekStart.getDate() + i);

                    const schedules = data.schedules.filter(s => {
                        if (!isScheduleActiveOn(s, cellDate) || parseInt(s.day) !== dayNum) return false;
                        const startHourSched = parseInt(s.startTime.split(':')[0]);
                        const endHourSched = parseInt(s.endTime.split(':')[0]);
                        return hour >= startHourSched && hour < endHourSched;
                    });
                    
                    html += `<div class="schedule-cell ${isWeekendDay ? 'weekend' : ''}">`;
                    schedules.forEach(s => {
                        const course = data.courses.find(c => c.id === s.courseId);
                        const teacher = data.teachers.find(t => t.id === s.teacherId);
                        const workshop = data.workshops.find(w => w.id === s.workshopId);
                        const color = workshop ? workshop.color : '#3498db';
                        html += `<div class="schedule-event" style="background: ${color};" onclick="showScheduleDetail('${s.id}')">
                            ${course ? course.name : ''}<br>
                            <small>${teacher ? teacher.name : ''}</small>
                        </div>`;
                    });
                    html += '</div>';
                }
            }
            html += '</div>';
            container.innerHTML = html;
        }

        // ==================== Schedule Management ====================
        function renderScheduleTable() {
            const tbody = document.getElementById('scheduleTable');
            const schedules = data.schedules.sort((a, b) => {
                if (a.day !== b.day) return parseInt(a.day) - parseInt(b.day);
                return a.startTime.localeCompare(b.startTime);
            });
            
            tbody.innerHTML = schedules.map(s => {
                const course = data.courses.find(c => c.id === s.courseId);
                const teacher = data.teachers.find(t => t.id === s.teacherId);
                const workshop = data.workshops.find(w => w.id === s.workshopId);
                
                return `
                    <tr>
                        <td>${getDayName(parseInt(s.day))}</td>
                        <td>${s.startTime} - ${s.endTime}</td>
                        <td>${course ? course.name : '-'}</td>
                        <td>${teacher ? teacher.name : '-'}</td>
                        <td>
                            ${workshop ? `<span class="workshop-color" style="background: ${workshop.color};"></span>${workshop.name}` : '-'}
                        </td>
                        <td>
                            <span class="tag ${s.active ? 'tag-green' : 'tag-red'}">${s.active ? 'Aktif' : 'Pasif'}</span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-primary" onclick="editSchedule('${s.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteSchedule('${s.id}')">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openScheduleModal(id = null) {
            document.getElementById('scheduleForm').reset();
            document.getElementById('scheduleId').value = '';
            document.getElementById('scheduleModalTitle').textContent = 'Yeni Ders Ekle';

            populateScheduleSelects();

            const courseSelect = document.getElementById('scheduleCourse');
            courseSelect.onchange = function() {
                applyCourseTimesToSchedule(this.value, true);
            };

            if (id) {
                const schedule = data.schedules.find(s => s.id === id);
                if (schedule) {
                    document.getElementById('scheduleModalTitle').textContent = 'Ders D√ºzenle';
                    document.getElementById('scheduleId').value = schedule.id;
                    document.getElementById('scheduleCourse').value = schedule.courseId;
                    document.getElementById('scheduleTeacher').value = schedule.teacherId;
                    document.getElementById('scheduleWorkshop').value = schedule.workshopId;
                    document.getElementById('scheduleDay').value = schedule.day;
                    document.getElementById('scheduleStartTime').value = schedule.startTime;
                    document.getElementById('scheduleEndTime').value = schedule.endTime;
                    document.getElementById('scheduleStartDate').value = schedule.startDate || '';
                    const calculatedEnd = getScheduleEndDate(schedule);
                    document.getElementById('scheduleEndDate').value = schedule.endDate || (calculatedEnd ? formatDateForInput(calculatedEnd) : '');
                    document.getElementById('scheduleNotes').value = schedule.notes || '';
                    document.getElementById('scheduleActive').checked = schedule.active;
                }
            }

            if (!id && courseSelect.value) {
                applyCourseTimesToSchedule(courseSelect.value);
            }

            openModal('scheduleModal');
        }

        function populateScheduleSelects() {
            const courseSelect = document.getElementById('scheduleCourse');
            const teacherSelect = document.getElementById('scheduleTeacher');
            const workshopSelect = document.getElementById('scheduleWorkshop');

            courseSelect.innerHTML = '<option value="">Kurs Se√ßin</option>' +
                data.courses.filter(c => c.active).map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            teacherSelect.innerHTML = '<option value="">Eƒüitmen Se√ßin</option>' +
                data.teachers.filter(t => t.active).map(t => `<option value="${t.id}">${t.name} (${t.branch})</option>`).join('');

            workshopSelect.innerHTML = '<option value="">At√∂lye Se√ßin</option>' +
                data.workshops.filter(w => w.active).map(w => `<option value="${w.id}">${w.name}</option>`).join('');
        }

        function applyCourseTimesToSchedule(courseId, overwrite = false) {
            const course = data.courses.find(c => c.id === courseId);
            if (!course) return;

            const startInput = document.getElementById('scheduleStartTime');
            const endInput = document.getElementById('scheduleEndTime');

            if (overwrite || !startInput.value) {
                startInput.value = course.startTime || '';
            }

            if (overwrite || !endInput.value) {
                endInput.value = course.endTime || '';
            }
        }

        function saveSchedule() {
            const id = document.getElementById('scheduleId').value;
            const courseId = document.getElementById('scheduleCourse').value;
            const teacherId = document.getElementById('scheduleTeacher').value;
            const workshopId = document.getElementById('scheduleWorkshop').value;
            const day = document.getElementById('scheduleDay').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            
            if (!courseId || !teacherId || !workshopId || !day || !startTime || !endTime) {
                showNotification('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            // Check for conflicts
            const conflict = data.schedules.find(s => {
                if (id && s.id === id) return false;
                if (s.day !== day || !s.active) return false;
                
                // Same workshop, overlapping time
                if (s.workshopId === workshopId) {
                    if ((startTime >= s.startTime && startTime < s.endTime) ||
                        (endTime > s.startTime && endTime <= s.endTime) ||
                        (startTime <= s.startTime && endTime >= s.endTime)) {
                        return true;
                    }
                }
                
                // Same teacher, overlapping time
                if (s.teacherId === teacherId) {
                    if ((startTime >= s.startTime && startTime < s.endTime) ||
                        (endTime > s.startTime && endTime <= s.endTime) ||
                        (startTime <= s.startTime && endTime >= s.endTime)) {
                        return true;
                    }
                }
                
                return false;
            });

            if (conflict) {
                const conflictWorkshop = data.workshops.find(w => w.id === conflict.workshopId);
                const conflictTeacher = data.teachers.find(t => t.id === conflict.teacherId);
                showNotification(`√áakƒ±≈üma tespit edildi! ${conflictWorkshop?.name || ''} / ${conflictTeacher?.name || ''} - ${conflict.startTime}-${conflict.endTime}`, 'error');
                return;
            }

            const startDateValue = document.getElementById('scheduleStartDate').value;
            let endDateValue = document.getElementById('scheduleEndDate').value;

            if (!endDateValue && startDateValue) {
                const course = data.courses.find(c => c.id === courseId);
                if (course?.duration) {
                    const autoEnd = parseLocalDate(startDateValue);
                    if (autoEnd) {
                        autoEnd.setDate(autoEnd.getDate() + (course.duration * 7) - 1);
                        endDateValue = formatDateForInput(autoEnd);
                    }
                }
            }

            const scheduleData = {
                id: id || generateId(),
                courseId,
                teacherId,
                workshopId,
                day,
                startTime,
                endTime,
                startDate: startDateValue,
                endDate: endDateValue,
                notes: document.getElementById('scheduleNotes').value,
                active: document.getElementById('scheduleActive').checked
            };

            if (id) {
                const index = data.schedules.findIndex(s => s.id === id);
                data.schedules[index] = scheduleData;
                showNotification('Ders g√ºncellendi!');
            } else {
                data.schedules.push(scheduleData);
                showNotification('Yeni ders eklendi!');
            }

            const focusDate = startDateValue ? parseLocalDate(startDateValue) : new Date();
            if (focusDate && !isNaN(focusDate)) {
                currentMonth = focusDate.getMonth();
                currentYear = focusDate.getFullYear();
            }

            saveData();
            closeModal('scheduleModal');
            renderAll();
        }

        function editSchedule(id) {
            openScheduleModal(id);
        }

        function deleteSchedule(id) {
            if (confirm('Bu dersi silmek istediƒüinizden emin misiniz?')) {
                data.schedules = data.schedules.filter(s => s.id !== id);
                saveData();
                showNotification('Ders silindi!');
                renderAll();
            }
        }

        function showScheduleDetail(id) {
            const schedule = data.schedules.find(s => s.id === id);
            if (!schedule) return;
            
            const course = data.courses.find(c => c.id === schedule.courseId);
            const teacher = data.teachers.find(t => t.id === schedule.teacherId);
            const workshop = data.workshops.find(w => w.id === schedule.workshopId);
            
            document.getElementById('detailModalTitle').textContent = 'Ders Detayƒ±';
            document.getElementById('detailModalContent').innerHTML = `
                <div class="form-grid">
                    <div><strong>Kurs:</strong> ${course ? course.name : '-'}</div>
                    <div><strong>Eƒüitmen:</strong> ${teacher ? teacher.name : '-'}</div>
                    <div><strong>At√∂lye:</strong> ${workshop ? workshop.name : '-'}</div>
                    <div><strong>G√ºn:</strong> ${getDayName(parseInt(schedule.day))}</div>
                    <div><strong>Saat:</strong> ${schedule.startTime} - ${schedule.endTime}</div>
                    <div><strong>Durum:</strong> ${schedule.active ? 'Aktif' : 'Pasif'}</div>
                </div>
                ${schedule.notes ? `<div style="margin-top: 1rem;"><strong>Notlar:</strong><br>${schedule.notes}</div>` : ''}
                <div class="btn-group" style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="closeModal('detailModal'); editSchedule('${schedule.id}');">‚úèÔ∏è D√ºzenle</button>
                </div>
            `;
            openModal('detailModal');
        }

        function searchSchedule() {
            const query = document.getElementById('scheduleSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#scheduleTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function filterSchedule() {
            renderScheduleTable();
            renderCalendar();
        }

        // ==================== Course Management ====================
        function renderCoursesTable() {
            const tbody = document.getElementById('coursesTable');
            
            tbody.innerHTML = data.courses.map(c => {
                const enrolledCount = data.students.filter(s => s.active && s.courses && s.courses.includes(c.id)).length;
                const progressPercent = c.capacity ? Math.min((enrolledCount / c.capacity) * 100, 100) : 0;
                
                return `
                    <tr>
                        <td><strong>${c.name}</strong></td>
                        <td><span class="tag tag-blue">${c.category}</span></td>
                        <td>${c.duration} hafta</td>
                        <td>${c.capacity}</td>
                        <td>
                            ${enrolledCount}
                            <div class="progress-bar" style="width: 100px; margin-top: 4px;">
                                <div class="progress-fill" style="width: ${progressPercent}%;"></div>
                            </div>
                        </td>
                        <td>
                            <span class="tag ${c.active ? 'tag-green' : 'tag-red'}">${c.active ? 'Aktif' : 'Pasif'}</span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-secondary" onclick="showCourseDetail('${c.id}')">üëÅÔ∏è</button>
                                <button class="btn btn-sm btn-primary" onclick="editCourse('${c.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteCourse('${c.id}')">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openCourseModal(id = null) {
            document.getElementById('courseForm').reset();
            document.getElementById('courseId').value = '';
            document.getElementById('courseModalTitle').textContent = 'Yeni Kurs Ekle';
            
            populateCategorySelect();
            
            if (id) {
                const course = data.courses.find(c => c.id === id);
                if (course) {
                    document.getElementById('courseModalTitle').textContent = 'Kurs D√ºzenle';
                    document.getElementById('courseId').value = course.id;
                    document.getElementById('courseName').value = course.name;
                    document.getElementById('courseCategorySelect').value = course.category;
                    document.getElementById('courseDuration').value = course.duration;
                    document.getElementById('courseCapacity').value = course.capacity;
                    document.getElementById('courseStartTime').value = course.startTime || '';
                    document.getElementById('courseEndTime').value = course.endTime || '';
                    document.getElementById('courseAgeGroup').value = course.ageGroup || 'all';
                    document.getElementById('courseLevel').value = course.level || 'beginner';
                    document.getElementById('courseDescription').value = course.description || '';
                    document.getElementById('courseMaterials').value = course.materials || '';
                    document.getElementById('courseActive').checked = course.active;
                }
            }
            
            openModal('courseModal');
        }

        function populateCategorySelect() {
            const select = document.getElementById('courseCategorySelect');
            select.innerHTML = data.categories.map(c => `<option value="${c}">${c}</option>`).join('');
        }

        function saveCourse() {
            const id = document.getElementById('courseId').value;
            const name = document.getElementById('courseName').value.trim();
            const category = document.getElementById('courseCategorySelect').value;
            const startTime = document.getElementById('courseStartTime').value;
            const endTime = document.getElementById('courseEndTime').value;

            if (!name || !category) {
                showNotification('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            if (!startTime || !endTime) {
                showNotification('L√ºtfen kursun ba≈ülangƒ±√ß ve biti≈ü saatlerini girin!', 'error');
                return;
            }

            if (endTime <= startTime) {
                showNotification('Biti≈ü saati ba≈ülangƒ±√ß saatinden sonra olmalƒ±dƒ±r!', 'error');
                return;
            }

            const courseData = {
                id: id || generateId(),
                name,
                category,
                duration: parseInt(document.getElementById('courseDuration').value) || 12,
                capacity: parseInt(document.getElementById('courseCapacity').value) || 20,
                startTime,
                endTime,
                ageGroup: document.getElementById('courseAgeGroup').value,
                level: document.getElementById('courseLevel').value,
                description: document.getElementById('courseDescription').value,
                materials: document.getElementById('courseMaterials').value,
                active: document.getElementById('courseActive').checked
            };

            if (id) {
                const index = data.courses.findIndex(c => c.id === id);
                data.courses[index] = courseData;
                showNotification('Kurs g√ºncellendi!');
            } else {
                data.courses.push(courseData);
                showNotification('Yeni kurs eklendi!');
            }

            saveData();
            closeModal('courseModal');
            renderAll();
        }

        function editCourse(id) {
            openCourseModal(id);
        }

        function deleteCourse(id) {
            const course = data.courses.find(c => c.id === id);
            if (!course) return;

            const relatedSchedules = data.schedules.filter(s => s.courseId === id);
            const enrolledStudents = data.students.filter(s => s.courses?.includes(id));

            const confirmMessage = relatedSchedules.length > 0 || enrolledStudents.length > 0
                ? 'Bu kursa ait dersler ve √∂ƒürenci kayƒ±tlarƒ± silinecek. Devam etmek istiyor musunuz?'
                : 'Bu kursu silmek istediƒüinizden emin misiniz?';

            if (confirm(confirmMessage)) {
                data.schedules = data.schedules.filter(s => s.courseId !== id);
                data.students = data.students.map(student => ({
                    ...student,
                    courses: (student.courses || []).filter(cid => cid !== id)
                }));
                data.courses = data.courses.filter(c => c.id !== id);
                saveData();
                showNotification('Kurs silindi!');
                renderAll();
            }
        }

        function showCourseDetail(id) {
            const course = data.courses.find(c => c.id === id);
            if (!course) return;
            
            const enrolledStudents = data.students.filter(s => s.courses && s.courses.includes(id));
            const courseSchedules = data.schedules.filter(s => s.courseId === id && s.active);
            
            const ageGroups = {
                'child': '√áocuk (7-12)',
                'teen': 'Gen√ß (13-18)',
                'adult': 'Yeti≈ükin (18+)',
                'senior': '65+',
                'all': 'T√ºm Ya≈ülar'
            };
            
            const levels = {
                'beginner': 'Ba≈ülangƒ±√ß',
                'intermediate': 'Orta',
                'advanced': 'ƒ∞leri'
            };
            
            document.getElementById('detailModalTitle').textContent = course.name;
            document.getElementById('detailModalContent').innerHTML = `
                <div class="form-grid">
                    <div><strong>Kategori:</strong> ${course.category}</div>
                    <div><strong>S√ºre:</strong> ${course.duration} hafta</div>
                    <div><strong>Kapasite:</strong> ${course.capacity}</div>
                    <div><strong>Kayƒ±tlƒ±:</strong> ${enrolledStudents.length}</div>
                    <div><strong>Saat:</strong> ${course.startTime && course.endTime ? `${course.startTime} - ${course.endTime}` : '-'}
                    </div>
                    <div><strong>Ya≈ü Grubu:</strong> ${ageGroups[course.ageGroup] || '-'}</div>
                    <div><strong>Seviye:</strong> ${levels[course.level] || '-'}</div>
                </div>
                ${course.description ? `<div style="margin-top: 1rem;"><strong>A√ßƒ±klama:</strong><br>${course.description}</div>` : ''}
                ${course.materials ? `<div style="margin-top: 1rem;"><strong>Gerekli Malzemeler:</strong><br>${course.materials}</div>` : ''}
                
                <h4 style="margin-top: 1.5rem;">Ders Programƒ±</h4>
                ${courseSchedules.length > 0 ? `
                    <table style="margin-top: 0.5rem;">
                        <thead>
                            <tr><th>G√ºn</th><th>Saat</th><th>At√∂lye</th><th>Eƒüitmen</th></tr>
                        </thead>
                        <tbody>
                            ${courseSchedules.map(s => {
                                const workshop = data.workshops.find(w => w.id === s.workshopId);
                                const teacher = data.teachers.find(t => t.id === s.teacherId);
                                return `<tr>
                                    <td>${getDayName(parseInt(s.day))}</td>
                                    <td>${s.startTime} - ${s.endTime}</td>
                                    <td>${workshop ? workshop.name : '-'}</td>
                                    <td>${teacher ? teacher.name : '-'}</td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                ` : '<p>Hen√ºz ders programƒ± eklenmemi≈ü.</p>'}
                
                <h4 style="margin-top: 1.5rem;">Kayƒ±tlƒ± √ñƒürenciler (${enrolledStudents.length})</h4>
                ${enrolledStudents.length > 0 ? `
                    <div style="max-height: 150px; overflow-y: auto;">
                        ${enrolledStudents.map(s => `<span class="tag tag-blue">${s.name}</span>`).join('')}
                    </div>
                ` : '<p>Hen√ºz kayƒ±tlƒ± √∂ƒürenci yok.</p>'}
            `;
            openModal('detailModal');
        }

        function searchCourses() {
            const query = document.getElementById('courseSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#coursesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function filterCourses() {
            const category = document.getElementById('courseCategory').value;
            const rows = document.querySelectorAll('#coursesTable tr');
            
            rows.forEach(row => {
                if (!category) {
                    row.style.display = '';
                } else {
                    const rowCategory = row.querySelector('.tag-blue')?.textContent;
                    row.style.display = rowCategory === category ? '' : 'none';
                }
            });
        }

        // ==================== Workshop Management ====================
        function renderWorkshopsTable() {
            const tbody = document.getElementById('workshopsTable');
            
            tbody.innerHTML = data.workshops.map(w => `
                <tr>
                    <td><span class="workshop-color" style="background: ${w.color};"></span></td>
                    <td><strong>${w.name}</strong></td>
                    <td>${w.location || '-'}</td>
                    <td>${w.capacity}</td>
                    <td>${w.equipment || '-'}</td>
                    <td>
                        <span class="tag ${w.active ? 'tag-green' : 'tag-red'}">${w.active ? 'Aktif' : 'Pasif'}</span>
                    </td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-secondary" onclick="showWorkshopSchedule('${w.id}')">üìÖ</button>
                            <button class="btn btn-sm btn-primary" onclick="editWorkshop('${w.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteWorkshop('${w.id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function openWorkshopModal(id = null) {
            document.getElementById('workshopForm').reset();
            document.getElementById('workshopId').value = '';
            document.getElementById('workshopModalTitle').textContent = 'Yeni At√∂lye Ekle';
            
            // Reset color picker
            document.querySelectorAll('#workshopColorPicker .color-option').forEach((el, i) => {
                el.classList.toggle('selected', i === 0);
            });
            
            if (id) {
                const workshop = data.workshops.find(w => w.id === id);
                if (workshop) {
                    document.getElementById('workshopModalTitle').textContent = 'At√∂lye D√ºzenle';
                    document.getElementById('workshopId').value = workshop.id;
                    document.getElementById('workshopName').value = workshop.name;
                    document.getElementById('workshopLocation').value = workshop.location || '';
                    document.getElementById('workshopCapacity').value = workshop.capacity;
                    document.getElementById('workshopEquipment').value = workshop.equipment || '';
                    document.getElementById('workshopActive').checked = workshop.active;
                    
                    // Set color
                    document.querySelectorAll('#workshopColorPicker .color-option').forEach(el => {
                        el.classList.toggle('selected', el.dataset.color === workshop.color);
                    });
                }
            }
            
            openModal('workshopModal');
        }

        function saveWorkshop() {
            const id = document.getElementById('workshopId').value;
            const name = document.getElementById('workshopName').value.trim();
            
            if (!name) {
                showNotification('L√ºtfen at√∂lye adƒ±nƒ± girin!', 'error');
                return;
            }

            const selectedColor = document.querySelector('#workshopColorPicker .color-option.selected');
            const color = selectedColor ? selectedColor.dataset.color : '#3498db';

            const workshopData = {
                id: id || generateId(),
                name,
                location: document.getElementById('workshopLocation').value,
                capacity: parseInt(document.getElementById('workshopCapacity').value) || 20,
                equipment: document.getElementById('workshopEquipment').value,
                color,
                active: document.getElementById('workshopActive').checked
            };

            if (id) {
                const index = data.workshops.findIndex(w => w.id === id);
                data.workshops[index] = workshopData;
                showNotification('At√∂lye g√ºncellendi!');
            } else {
                data.workshops.push(workshopData);
                showNotification('Yeni at√∂lye eklendi!');
            }

            saveData();
            closeModal('workshopModal');
            renderAll();
        }

        function editWorkshop(id) {
            openWorkshopModal(id);
        }

        function deleteWorkshop(id) {
            const hasSchedules = data.schedules.some(s => s.workshopId === id);
            if (hasSchedules) {
                showNotification('Bu at√∂lyede dersler var! √ñnce dersleri silin veya ta≈üƒ±yƒ±n.', 'error');
                return;
            }
            
            if (confirm('Bu at√∂lyeyi silmek istediƒüinizden emin misiniz?')) {
                data.workshops = data.workshops.filter(w => w.id !== id);
                saveData();
                showNotification('At√∂lye silindi!');
                renderAll();
            }
        }

        function showWorkshopSchedule(id) {
            const workshop = data.workshops.find(w => w.id === id);
            if (!workshop) return;
            
            const workshopSchedules = data.schedules.filter(s => s.workshopId === id && s.active);
            
            document.getElementById('detailModalTitle').textContent = `${workshop.name} - Haftalƒ±k Program`;
            
            let scheduleHtml = '<div class="weekly-schedule" style="font-size: 0.8rem;">';
            scheduleHtml += '<div class="schedule-header">Saat</div>';
            
            const days = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            days.forEach(day => {
                scheduleHtml += `<div class="schedule-header">${day}</div>`;
            });
            
            for (let hour = 9; hour < 21; hour++) {
                const time = `${String(hour).padStart(2, '0')}:00`;
                scheduleHtml += `<div class="schedule-time">${time}</div>`;
                
                for (let i = 0; i < 7; i++) {
                    const dayNum = i === 6 ? 0 : i + 1;
                    const schedule = workshopSchedules.find(s => {
                        if (parseInt(s.day) !== dayNum) return false;
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        const endHour = parseInt(s.endTime.split(':')[0]);
                        return hour >= startHour && hour < endHour;
                    });
                    
                    if (schedule) {
                        const course = data.courses.find(c => c.id === schedule.courseId);
                        scheduleHtml += `<div class="schedule-cell" style="background: ${workshop.color}20;">
                            <small style="color: ${workshop.color};">${course ? course.name : ''}</small>
                        </div>`;
                    } else {
                        scheduleHtml += '<div class="schedule-cell"></div>';
                    }
                }
            }
            scheduleHtml += '</div>';
            
            document.getElementById('detailModalContent').innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>Konum:</strong> ${workshop.location || '-'}<br>
                    <strong>Kapasite:</strong> ${workshop.capacity} ki≈üi<br>
                    <strong>Donanƒ±m:</strong> ${workshop.equipment || '-'}
                </div>
                ${scheduleHtml}
            `;
            openModal('detailModal');
        }

        function searchWorkshops() {
            const query = document.getElementById('workshopSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#workshopsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // ==================== Teacher Management ====================
        function renderTeachersTable() {
            const tbody = document.getElementById('teachersTable');
            
            tbody.innerHTML = data.teachers.map(t => {
                const lessonCount = data.schedules.filter(s => s.teacherId === t.id && s.active).length;
                
                return `
                    <tr>
                        <td><strong>${t.name}</strong></td>
                        <td>${t.branch}</td>
                        <td>${t.phone || '-'}</td>
                        <td>${t.email || '-'}</td>
                        <td>${lessonCount} ders/hafta</td>
                        <td>
                            <span class="tag ${t.active ? 'tag-green' : 'tag-red'}">${t.active ? 'Aktif' : 'Pasif'}</span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-secondary" onclick="showTeacherDetail('${t.id}')">üëÅÔ∏è</button>
                                <button class="btn btn-sm btn-primary" onclick="editTeacher('${t.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteTeacher('${t.id}')">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openTeacherModal(id = null) {
            document.getElementById('teacherForm').reset();
            document.getElementById('teacherId').value = '';
            document.getElementById('teacherModalTitle').textContent = 'Yeni Eƒüitmen Ekle';
            
            if (id) {
                const teacher = data.teachers.find(t => t.id === id);
                if (teacher) {
                    document.getElementById('teacherModalTitle').textContent = 'Eƒüitmen D√ºzenle';
                    document.getElementById('teacherId').value = teacher.id;
                    document.getElementById('teacherName').value = teacher.name;
                    document.getElementById('teacherTc').value = teacher.tc || '';
                    document.getElementById('teacherBranch').value = teacher.branch;
                    document.getElementById('teacherPhone').value = teacher.phone || '';
                    document.getElementById('teacherEmail').value = teacher.email || '';
                    document.getElementById('teacherAddress').value = teacher.address || '';
                    document.getElementById('teacherNotes').value = teacher.notes || '';
                    document.getElementById('teacherActive').checked = teacher.active;
                }
            }
            
            openModal('teacherModal');
        }

        function saveTeacher() {
            const id = document.getElementById('teacherId').value;
            const name = document.getElementById('teacherName').value.trim();
            const branch = document.getElementById('teacherBranch').value.trim();
            
            if (!name || !branch) {
                showNotification('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            const teacherData = {
                id: id || generateId(),
                name,
                tc: document.getElementById('teacherTc').value,
                branch,
                phone: document.getElementById('teacherPhone').value,
                email: document.getElementById('teacherEmail').value,
                address: document.getElementById('teacherAddress').value,
                notes: document.getElementById('teacherNotes').value,
                active: document.getElementById('teacherActive').checked
            };

            if (id) {
                const index = data.teachers.findIndex(t => t.id === id);
                data.teachers[index] = teacherData;
                showNotification('Eƒüitmen g√ºncellendi!');
            } else {
                data.teachers.push(teacherData);
                showNotification('Yeni eƒüitmen eklendi!');
            }

            saveData();
            closeModal('teacherModal');
            renderAll();
        }

        function editTeacher(id) {
            openTeacherModal(id);
        }

        function deleteTeacher(id) {
            const hasSchedules = data.schedules.some(s => s.teacherId === id);
            if (hasSchedules) {
                showNotification('Bu eƒüitmene ait dersler var! √ñnce dersleri silin veya ba≈üka eƒüitmene atayƒ±n.', 'error');
                return;
            }
            
            if (confirm('Bu eƒüitmeni silmek istediƒüinizden emin misiniz?')) {
                data.teachers = data.teachers.filter(t => t.id !== id);
                saveData();
                showNotification('Eƒüitmen silindi!');
                renderAll();
            }
        }

        function showTeacherDetail(id) {
            const teacher = data.teachers.find(t => t.id === id);
            if (!teacher) return;
            
            const teacherSchedules = data.schedules.filter(s => s.teacherId === id && s.active);
            
            document.getElementById('detailModalTitle').textContent = teacher.name;
            document.getElementById('detailModalContent').innerHTML = `
                <div class="form-grid">
                    <div><strong>Bran≈ü:</strong> ${teacher.branch}</div>
                    <div><strong>Telefon:</strong> ${teacher.phone || '-'}</div>
                    <div><strong>E-posta:</strong> ${teacher.email || '-'}</div>
                    <div><strong>Adres:</strong> ${teacher.address || '-'}</div>
                    <div><strong>Haftalƒ±k Ders:</strong> ${teacherSchedules.length}</div>
                    <div><strong>Durum:</strong> ${teacher.active ? 'Aktif' : 'Pasif'}</div>
                </div>
                ${teacher.notes ? `<div style="margin-top: 1rem;"><strong>Notlar:</strong><br>${teacher.notes}</div>` : ''}
                
                <h4 style="margin-top: 1.5rem;">Ders Programƒ±</h4>
                ${teacherSchedules.length > 0 ? `
                    <table style="margin-top: 0.5rem;">
                        <thead>
                            <tr><th>G√ºn</th><th>Saat</th><th>Kurs</th><th>At√∂lye</th></tr>
                        </thead>
                        <tbody>
                            ${teacherSchedules.sort((a, b) => parseInt(a.day) - parseInt(b.day)).map(s => {
                                const course = data.courses.find(c => c.id === s.courseId);
                                const workshop = data.workshops.find(w => w.id === s.workshopId);
                                return `<tr>
                                    <td>${getDayName(parseInt(s.day))}</td>
                                    <td>${s.startTime} - ${s.endTime}</td>
                                    <td>${course ? course.name : '-'}</td>
                                    <td>${workshop ? workshop.name : '-'}</td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                ` : '<p>Hen√ºz ders programƒ± yok.</p>'}
            `;
            openModal('detailModal');
        }

        function searchTeachers() {
            const query = document.getElementById('teacherSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#teachersTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // ==================== Student Management ====================
        function renderStudentsTable() {
            const tbody = document.getElementById('studentsTable');
            
            tbody.innerHTML = data.students.map(s => {
                const enrolledCourses = s.courses ? s.courses.map(cId => {
                    const course = data.courses.find(c => c.id === cId);
                    return course ? course.name : '';
                }).filter(Boolean) : [];
                
                return `
                    <tr>
                        <td><strong>${s.name}</strong></td>
                        <td>${s.tc || '-'}</td>
                        <td>${s.phone || '-'}</td>
                        <td>
                            ${enrolledCourses.length > 0 ? 
                                enrolledCourses.map(c => `<span class="tag tag-blue" style="font-size: 0.7rem;">${c}</span>`).join('') : 
                                '-'}
                        </td>
                        <td>${formatDate(s.registrationDate)}</td>
                        <td>
                            <span class="tag ${s.active ? 'tag-green' : 'tag-red'}">${s.active ? 'Aktif' : 'Pasif'}</span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-secondary" onclick="showStudentDetail('${s.id}')">üëÅÔ∏è</button>
                                <button class="btn btn-sm btn-primary" onclick="editStudent('${s.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteStudent('${s.id}')">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openStudentModal(id = null) {
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            document.getElementById('studentModalTitle').textContent = 'Yeni √ñƒürenci Ekle';
            
            // Render course checkboxes
            const checkboxContainer = document.getElementById('studentCoursesCheckboxes');
            checkboxContainer.innerHTML = data.courses.filter(c => c.active).map(c => `
                <label style="display: inline-flex; align-items: center; margin-right: 1rem; margin-bottom: 0.5rem;">
                    <input type="checkbox" name="studentCourses" value="${c.id}"> ${c.name}
                </label>
            `).join('');
            
            if (id) {
                const student = data.students.find(s => s.id === id);
                if (student) {
                    document.getElementById('studentModalTitle').textContent = '√ñƒürenci D√ºzenle';
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentName').value = student.name;
                    document.getElementById('studentTc').value = student.tc || '';
                    document.getElementById('studentBirthdate').value = student.birthdate || '';
                    document.getElementById('studentPhone').value = student.phone || '';
                    document.getElementById('studentEmail').value = student.email || '';
                    document.getElementById('studentAddress').value = student.address || '';
                    document.getElementById('studentGuardian').value = student.guardian || '';
                    document.getElementById('studentNotes').value = student.notes || '';
                    document.getElementById('studentActive').checked = student.active;
                    
                    // Check enrolled courses
                    if (student.courses) {
                        student.courses.forEach(cId => {
                            const checkbox = checkboxContainer.querySelector(`input[value="${cId}"]`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                }
            }
            
            openModal('studentModal');
        }

        function saveStudent() {
            const id = document.getElementById('studentId').value;
            const name = document.getElementById('studentName').value.trim();
            const tc = document.getElementById('studentTc').value.trim();
            
            if (!name || !tc) {
                showNotification('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            // Get selected courses
            const selectedCourses = Array.from(document.querySelectorAll('input[name="studentCourses"]:checked'))
                .map(cb => cb.value);

            const studentData = {
                id: id || generateId(),
                name,
                tc,
                birthdate: document.getElementById('studentBirthdate').value,
                phone: document.getElementById('studentPhone').value,
                email: document.getElementById('studentEmail').value,
                address: document.getElementById('studentAddress').value,
                guardian: document.getElementById('studentGuardian').value,
                notes: document.getElementById('studentNotes').value,
                courses: selectedCourses,
                registrationDate: id ? data.students.find(s => s.id === id)?.registrationDate : new Date().toISOString().split('T')[0],
                active: document.getElementById('studentActive').checked
            };

            if (id) {
                const index = data.students.findIndex(s => s.id === id);
                data.students[index] = studentData;
                showNotification('√ñƒürenci g√ºncellendi!');
            } else {
                data.students.push(studentData);
                showNotification('Yeni √∂ƒürenci eklendi!');
            }

            saveData();
            closeModal('studentModal');
            renderAll();
        }

        function editStudent(id) {
            openStudentModal(id);
        }

        function deleteStudent(id) {
            if (confirm('Bu √∂ƒürenciyi silmek istediƒüinizden emin misiniz?')) {
                data.students = data.students.filter(s => s.id !== id);
                saveData();
                showNotification('√ñƒürenci silindi!');
                renderAll();
            }
        }

        function showStudentDetail(id) {
            const student = data.students.find(s => s.id === id);
            if (!student) return;
            
            const enrolledCourses = student.courses ? student.courses.map(cId => {
                return data.courses.find(c => c.id === cId);
            }).filter(Boolean) : [];
            
            document.getElementById('detailModalTitle').textContent = student.name;
            document.getElementById('detailModalContent').innerHTML = `
                <div class="form-grid">
                    <div><strong>TC Kimlik:</strong> ${student.tc}</div>
                    <div><strong>Doƒüum Tarihi:</strong> ${formatDate(student.birthdate)}</div>
                    <div><strong>Telefon:</strong> ${student.phone || '-'}</div>
                    <div><strong>E-posta:</strong> ${student.email || '-'}</div>
                    <div><strong>Adres:</strong> ${student.address || '-'}</div>
                    <div><strong>Kayƒ±t Tarihi:</strong> ${formatDate(student.registrationDate)}</div>
                </div>
                ${student.guardian ? `<div style="margin-top: 1rem;"><strong>Veli Bilgisi:</strong> ${student.guardian}</div>` : ''}
                ${student.notes ? `<div style="margin-top: 1rem;"><strong>Notlar:</strong><br>${student.notes}</div>` : ''}
                
                <h4 style="margin-top: 1.5rem;">Kayƒ±tlƒ± Kurslar</h4>
                ${enrolledCourses.length > 0 ? `
                    <table style="margin-top: 0.5rem;">
                        <thead>
                            <tr><th>Kurs</th><th>Kategori</th><th>Seviye</th></tr>
                        </thead>
                        <tbody>
                            ${enrolledCourses.map(c => `<tr>
                                <td>${c.name}</td>
                                <td>${c.category}</td>
                                <td>${c.level === 'beginner' ? 'Ba≈ülangƒ±√ß' : c.level === 'intermediate' ? 'Orta' : 'ƒ∞leri'}</td>
                            </tr>`).join('')}
                        </tbody>
                    </table>
                ` : '<p>Hen√ºz kayƒ±tlƒ± kurs yok.</p>'}
            `;
            openModal('detailModal');
        }

        function searchStudents() {
            const query = document.getElementById('studentSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#studentsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function filterStudents() {
            const courseId = document.getElementById('studentCourse').value;
            const rows = document.querySelectorAll('#studentsTable tr');
            
            if (!courseId) {
                rows.forEach(row => row.style.display = '');
                return;
            }
            
            data.students.forEach((student, index) => {
                const hasSelectedCourse = student.courses && student.courses.includes(courseId);
                if (rows[index]) {
                    rows[index].style.display = hasSelectedCourse ? '' : 'none';
                }
            });
        }

        // ==================== Holiday Management ====================
        function renderHolidaysTable() {
            const tbody = document.getElementById('holidaysTable');
            
            tbody.innerHTML = data.holidays.map(h => `
                <tr>
                    <td><strong>${h.name}</strong></td>
                    <td>${h.recurring ? h.startDate : formatDate(h.startDate)}</td>
                    <td>${h.recurring ? h.endDate : formatDate(h.endDate)}</td>
                    <td>
                        <span class="tag ${h.recurring ? 'tag-green' : 'tag-yellow'}">${h.recurring ? 'Evet' : 'Hayƒ±r'}</span>
                    </td>
                    <td>${h.description || '-'}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-primary" onclick="editHoliday('${h.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteHoliday('${h.id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            renderYearlyHolidayCalendar();
        }

        function renderYearlyHolidayCalendar() {
            const container = document.getElementById('yearlyHolidayCalendar');
            const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            let html = '<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">';
            
            months.forEach((month, monthIndex) => {
                html += `<div style="background: #f8f9fa; padding: 0.5rem; border-radius: var(--border-radius);">
                    <h4 style="text-align: center; margin-bottom: 0.5rem;">${month}</h4>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; font-size: 0.7rem;">`;
                
                const firstDay = new Date(currentYear, monthIndex, 1);
                const lastDay = new Date(currentYear, monthIndex + 1, 0);
                const startDay = (firstDay.getDay() + 6) % 7;
                
                // Empty cells for days before month starts
                for (let i = 0; i < startDay; i++) {
                    html += '<div></div>';
                }
                
                // Days of month
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const date = new Date(currentYear, monthIndex, day);
                    const isWeekendDay = isWeekend(date);
                    const isHolidayDay = isHoliday(date);
                    
                    let style = 'text-align: center; padding: 2px;';
                    if (isHolidayDay) style += ' background: #fab1a0; border-radius: 3px;';
                    else if (isWeekendDay) style += ' background: #ffeaa7; border-radius: 3px;';
                    
                    html += `<div style="${style}" title="${isHolidayDay ? getHolidayName(date) : ''}">${day}</div>`;
                }
                
                html += '</div></div>';
            });
            
            html += '</div>';
            html += `<div style="margin-top: 1rem; display: flex; gap: 1rem; font-size: 0.85rem;">
                <span><span style="display: inline-block; width: 20px; height: 15px; background: #fab1a0; border-radius: 3px;"></span> Resmi Tatil</span>
                <span><span style="display: inline-block; width: 20px; height: 15px; background: #ffeaa7; border-radius: 3px;"></span> Hafta Sonu</span>
            </div>`;
            
            container.innerHTML = html;
        }

        function openHolidayModal(id = null) {
            document.getElementById('holidayForm').reset();
            document.getElementById('holidayId').value = '';
            document.getElementById('holidayModalTitle').textContent = 'Yeni Tatil Ekle';
            
            if (id) {
                const holiday = data.holidays.find(h => h.id === id);
                if (holiday) {
                    document.getElementById('holidayModalTitle').textContent = 'Tatil D√ºzenle';
                    document.getElementById('holidayId').value = holiday.id;
                    document.getElementById('holidayName').value = holiday.name;
                    
                    if (holiday.recurring) {
                        // For recurring holidays, convert MM-DD to full date for input
                        document.getElementById('holidayStartDate').value = `${currentYear}-${holiday.startDate}`;
                        document.getElementById('holidayEndDate').value = `${currentYear}-${holiday.endDate}`;
                    } else {
                        document.getElementById('holidayStartDate').value = holiday.startDate;
                        document.getElementById('holidayEndDate').value = holiday.endDate;
                    }
                    
                    document.getElementById('holidayRecurring').checked = holiday.recurring;
                    document.getElementById('holidayDescription').value = holiday.description || '';
                }
            }
            
            openModal('holidayModal');
        }

        function saveHoliday() {
            const id = document.getElementById('holidayId').value;
            const name = document.getElementById('holidayName').value.trim();
            let startDate = document.getElementById('holidayStartDate').value;
            let endDate = document.getElementById('holidayEndDate').value;
            const recurring = document.getElementById('holidayRecurring').checked;
            
            if (!name || !startDate || !endDate) {
                showNotification('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            // For recurring holidays, store only MM-DD format
            if (recurring) {
                startDate = startDate.substring(5); // Get MM-DD
                endDate = endDate.substring(5);
            }

            const holidayData = {
                id: id || generateId(),
                name,
                startDate,
                endDate,
                recurring,
                description: document.getElementById('holidayDescription').value
            };

            if (id) {
                const index = data.holidays.findIndex(h => h.id === id);
                data.holidays[index] = holidayData;
                showNotification('Tatil g√ºncellendi!');
            } else {
                data.holidays.push(holidayData);
                showNotification('Yeni tatil eklendi!');
            }

            saveData();
            closeModal('holidayModal');
            renderAll();
        }

        function editHoliday(id) {
            openHolidayModal(id);
        }

        function deleteHoliday(id) {
            if (confirm('Bu tatili silmek istediƒüinizden emin misiniz?')) {
                data.holidays = data.holidays.filter(h => h.id !== id);
                saveData();
                showNotification('Tatil silindi!');
                renderAll();
            }
        }

        // ==================== Reports ====================
        function updateReportOptions() {
            const reportType = document.getElementById('reportType').value;
            const filterSelect = document.getElementById('reportFilter');
            
            filterSelect.innerHTML = '<option value="">T√ºm√º</option>';
            
            switch (reportType) {
                case 'course':
                    data.courses.forEach(c => {
                        filterSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`;
                    });
                    break;
                case 'teacher':
                    data.teachers.forEach(t => {
                        filterSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
                    });
                    break;
                case 'workshop':
                    data.workshops.forEach(w => {
                        filterSelect.innerHTML += `<option value="${w.id}">${w.name}</option>`;
                    });
                    break;
                case 'student':
                    data.courses.forEach(c => {
                        filterSelect.innerHTML += `<option value="${c.id}">${c.name} (Kurs)</option>`;
                    });
                    break;
            }
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const filterId = document.getElementById('reportFilter').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            const resultDiv = document.getElementById('reportResult');
            const contentDiv = document.getElementById('reportContent');
            const titleSpan = document.getElementById('reportTitle');
            const dateSpan = document.getElementById('reportDate');
            
            dateSpan.textContent = `Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}`;
            
            let html = '';
            
            switch (reportType) {
                case 'course':
                    html = generateCourseReport(filterId);
                    titleSpan.textContent = 'üìö Kurs Raporu';
                    break;
                case 'teacher':
                    html = generateTeacherReport(filterId);
                    titleSpan.textContent = 'üë®‚Äçüè´ Eƒüitmen Raporu';
                    break;
                case 'workshop':
                    html = generateWorkshopReport(filterId);
                    titleSpan.textContent = 'üè¢ At√∂lye Kullanƒ±m Raporu';
                    break;
                case 'student':
                    html = generateStudentReport(filterId);
                    titleSpan.textContent = 'üë®‚Äçüéì √ñƒürenci Raporu';
                    break;
                case 'schedule':
                    html = generateScheduleReport();
                    titleSpan.textContent = 'üìÖ Haftalƒ±k Program Raporu';
                    break;
                case 'attendance':
                    html = generateAttendanceReport();
                    titleSpan.textContent = 'üìã Devam Durumu Raporu';
                    break;
            }
            
            contentDiv.innerHTML = html;
            resultDiv.style.display = 'block';
            showNotification('Rapor olu≈üturuldu!');
        }

        function generateCourseReport(filterId) {
            const courses = filterId ? data.courses.filter(c => c.id === filterId) : data.courses;
            
            let html = `
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <h3>${courses.length}</h3>
                        <p>Toplam Kurs</p>
                    </div>
                    <div class="stat-card">
                        <h3>${courses.filter(c => c.active).length}</h3>
                        <p>Aktif Kurs</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.students.filter(s => s.active).length}</h3>
                        <p>Toplam √ñƒürenci</p>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Kurs Adƒ±</th>
                            <th>Kategori</th>
                            <th>Kapasite</th>
                            <th>Kayƒ±tlƒ±</th>
                            <th>Doluluk %</th>
                            <th>Haftalƒ±k Ders</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            courses.forEach(c => {
                const enrolled = data.students.filter(s => s.courses && s.courses.includes(c.id)).length;
                const scheduleCount = data.schedules.filter(s => s.courseId === c.id && s.active).length;
                const occupancy = c.capacity ? Math.round((enrolled / c.capacity) * 100) : 0;
                
                html += `<tr>
                    <td>${c.name}</td>
                    <td>${c.category}</td>
                    <td>${c.capacity}</td>
                    <td>${enrolled}</td>
                    <td>${occupancy}%</td>
                    <td>${scheduleCount}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateTeacherReport(filterId) {
            const teachers = filterId ? data.teachers.filter(t => t.id === filterId) : data.teachers;
            
            let html = `
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <h3>${teachers.length}</h3>
                        <p>Toplam Eƒüitmen</p>
                    </div>
                    <div class="stat-card">
                        <h3>${teachers.filter(t => t.active).length}</h3>
                        <p>Aktif Eƒüitmen</p>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Eƒüitmen</th>
                            <th>Bran≈ü</th>
                            <th>Haftalƒ±k Ders</th>
                            <th>Haftalƒ±k Saat</th>
                            <th>Verdiƒüi Kurslar</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            teachers.forEach(t => {
                const schedules = data.schedules.filter(s => s.teacherId === t.id && s.active);
                let totalHours = 0;
                const courseNames = new Set();
                
                schedules.forEach(s => {
                    const start = parseInt(s.startTime.split(':')[0]);
                    const end = parseInt(s.endTime.split(':')[0]);
                    totalHours += (end - start);
                    
                    const course = data.courses.find(c => c.id === s.courseId);
                    if (course) courseNames.add(course.name);
                });
                
                html += `<tr>
                    <td>${t.name}</td>
                    <td>${t.branch}</td>
                    <td>${schedules.length}</td>
                    <td>${totalHours} saat</td>
                    <td>${Array.from(courseNames).join(', ') || '-'}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateWorkshopReport(filterId) {
            const workshops = filterId ? data.workshops.filter(w => w.id === filterId) : data.workshops;
            
            let html = `
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <h3>${workshops.length}</h3>
                        <p>Toplam At√∂lye</p>
                    </div>
                    <div class="stat-card">
                        <h3>${workshops.reduce((sum, w) => sum + w.capacity, 0)}</h3>
                        <p>Toplam Kapasite</p>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>At√∂lye</th>
                            <th>Kapasite</th>
                            <th>Haftalƒ±k Ders</th>
                            <th>Kullanƒ±m Saati</th>
                            <th>Doluluk %</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            workshops.forEach(w => {
                const schedules = data.schedules.filter(s => s.workshopId === w.id && s.active);
                let totalHours = 0;
                
                schedules.forEach(s => {
                    const start = parseInt(s.startTime.split(':')[0]);
                    const end = parseInt(s.endTime.split(':')[0]);
                    totalHours += (end - start);
                });
                
                // Maximum possible hours per week (assuming 12 hours per day, 7 days)
                const maxHours = 12 * 7;
                const occupancy = Math.round((totalHours / maxHours) * 100);
                
                html += `<tr>
                    <td><span class="workshop-color" style="background: ${w.color};"></span>${w.name}</td>
                    <td>${w.capacity}</td>
                    <td>${schedules.length}</td>
                    <td>${totalHours} saat</td>
                    <td>${occupancy}%</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateStudentReport(filterId) {
            let students = data.students;
            if (filterId) {
                students = students.filter(s => s.courses && s.courses.includes(filterId));
            }
            
            html = `
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <h3>${students.length}</h3>
                        <p>Toplam √ñƒürenci</p>
                    </div>
                    <div class="stat-card">
                        <h3>${students.filter(s => s.active).length}</h3>
                        <p>Aktif √ñƒürenci</p>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>√ñƒürenci</th>
                            <th>Telefon</th>
                            <th>Kayƒ±tlƒ± Kurs Sayƒ±sƒ±</th>
                            <th>Kayƒ±t Tarihi</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            students.forEach(s => {
                html += `<tr>
                    <td>${s.name}</td>
                    <td>${s.phone || '-'}</td>
                    <td>${s.courses ? s.courses.length : 0}</td>
                    <td>${formatDate(s.registrationDate)}</td>
                    <td>${s.active ? 'Aktif' : 'Pasif'}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateScheduleReport() {
            const days = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
            
            let html = '<h4>Haftalƒ±k Ders Programƒ±</h4>';
            html += '<div class="weekly-schedule" style="margin-top: 1rem;"><div class="schedule-header">Saat</div>';
            
            days.forEach(day => {
                html += `<div class="schedule-header">${day}</div>`;
            });
            
            for (let hour = 9; hour < 21; hour++) {
                const time = `${String(hour).padStart(2, '0')}:00`;
                html += `<div class="schedule-time">${time}</div>`;
                
                for (let i = 0; i < 7; i++) {
                    const dayNum = i === 6 ? 0 : i + 1;
                    const schedules = data.schedules.filter(s => {
                        if (!s.active || parseInt(s.day) !== dayNum) return false;
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        const endHour = parseInt(s.endTime.split(':')[0]);
                        return hour >= startHour && hour < endHour;
                    });
                    
                    html += '<div class="schedule-cell">';
                    schedules.forEach(s => {
                        const course = data.courses.find(c => c.id === s.courseId);
                        const workshop = data.workshops.find(w => w.id === s.workshopId);
                        html += `<div style="font-size: 0.7rem; background: ${workshop?.color || '#3498db'}; color: white; padding: 2px 4px; border-radius: 3px; margin-bottom: 2px;">${course?.name || ''}</div>`;
                    });
                    html += '</div>';
                }
            }
            html += '</div>';
            
            return html;
        }

        function generateAttendanceReport() {
            let html = '<p style="color: #7f8c8d;">Devam durumu takibi i√ßin yoklama mod√ºl√º eklenmelidir. Bu rapor ≈üu an i√ßin √∂rnek veri g√∂stermektedir.</p>';
            html += `
                <table>
                    <thead>
                        <tr>
                            <th>Kurs</th>
                            <th>Toplam √ñƒürenci</th>
                            <th>Ortalama Katƒ±lƒ±m</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.courses.filter(c => c.active).forEach(c => {
                const enrolled = data.students.filter(s => s.courses && s.courses.includes(c.id)).length;
                html += `<tr>
                    <td>${c.name}</td>
                    <td>${enrolled}</td>
                    <td>-%</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function exportReport(format) {
            const reportContent = document.getElementById('reportContent').innerHTML;
            const reportTitle = document.getElementById('reportTitle').textContent;
            
            if (format === 'excel') {
                // Simple CSV export
                const tables = document.getElementById('reportContent').querySelectorAll('table');
                let csv = '';
                
                tables.forEach(table => {
                    const rows = table.querySelectorAll('tr');
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('th, td');
                        const rowData = Array.from(cells).map(cell => `"${cell.textContent.trim()}"`).join(',');
                        csv += rowData + '\n';
                    });
                    csv += '\n';
                });
                
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${reportTitle.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                showNotification('Excel raporu indirildi!');
            } else if (format === 'pdf') {
                printReport();
            }
        }

        function printReport() {
            const reportContent = document.getElementById('reportResult').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Rapor - √áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #1a5276; color: white; }
                        .stats-grid { display: flex; gap: 20px; margin-bottom: 20px; }
                        .stat-card { background: #f5f5f5; padding: 15px; text-align: center; border-radius: 8px; }
                        .stat-card h3 { margin: 0; color: #1a5276; font-size: 24px; }
                        @media print { body { padding: 0; } }
                    </style>
                </head>
                <body>
                    <h2 style="text-align: center;">√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º</h2>
                    ${reportContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ==================== Settings & Categories ====================
        function renderCategories() {
            const container = document.getElementById('categoriesList');
            container.innerHTML = data.categories.map((cat, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 0.5rem;">
                    <span>${cat}</span>
                    <button class="btn btn-sm btn-danger" onclick="deleteCategory(${index})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function openCategoryModal() {
            renderCategoryList();
            openModal('categoryModal');
        }

        function renderCategoryList() {
            const container = document.getElementById('categoryList');
            container.innerHTML = data.categories.map((cat, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 0.5rem;">
                    <span>${cat}</span>
                    <button class="btn btn-sm btn-danger" onclick="deleteCategory(${index})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function addCategory() {
            const input = document.getElementById('newCategoryName');
            const name = input.value.trim();
            
            if (!name) {
                showNotification('Kategori adƒ± girin!', 'error');
                return;
            }
            
            if (data.categories.includes(name)) {
                showNotification('Bu kategori zaten mevcut!', 'error');
                return;
            }
            
            data.categories.push(name);
            saveData();
            input.value = '';
            renderCategoryList();
            renderCategories();
            showNotification('Kategori eklendi!');
        }

        function deleteCategory(index) {
            const category = data.categories[index];
            const hasCoursesInCategory = data.courses.some(c => c.category === category);
            
            if (hasCoursesInCategory) {
                showNotification('Bu kategoride kurslar var! √ñnce kurslarƒ±n kategorisini deƒüi≈ütirin.', 'error');
                return;
            }
            
            if (confirm(`"${category}" kategorisini silmek istediƒüinizden emin misiniz?`)) {
                data.categories.splice(index, 1);
                saveData();
                renderCategoryList();
                renderCategories();
                showNotification('Kategori silindi!');
            }
        }

        function setupColorPickers() {
            // Workshop color picker
            document.querySelectorAll('#workshopColorPicker .color-option').forEach(el => {
                el.addEventListener('click', function() {
                    document.querySelectorAll('#workshopColorPicker .color-option').forEach(e => e.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Theme color picker
            document.querySelectorAll('#themeColorPicker .color-option').forEach(el => {
                el.addEventListener('click', function() {
                    document.querySelectorAll('#themeColorPicker .color-option').forEach(e => e.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        function saveSettings() {
            data.settings.orgName = document.getElementById('settingOrgName').value;
            data.settings.startTime = document.getElementById('settingStartTime').value;
            data.settings.endTime = document.getElementById('settingEndTime').value;
            data.settings.lessonDuration = parseInt(document.getElementById('settingLessonDuration').value);
            data.settings.breakDuration = parseInt(document.getElementById('settingBreakDuration').value);
            data.settings.weekendOff = document.getElementById('settingWeekendOff').checked;
            
            const selectedThemeColor = document.querySelector('#themeColorPicker .color-option.selected');
            if (selectedThemeColor) {
                data.settings.primaryColor = selectedThemeColor.dataset.color;
                document.documentElement.style.setProperty('--primary-color', data.settings.primaryColor);
            }
            
            saveData();
            showNotification('Ayarlar kaydedildi!');
        }

        function loadSettings() {
            document.getElementById('settingOrgName').value = data.settings.orgName;
            document.getElementById('settingStartTime').value = data.settings.startTime;
            document.getElementById('settingEndTime').value = data.settings.endTime;
            document.getElementById('settingLessonDuration').value = data.settings.lessonDuration;
            document.getElementById('settingBreakDuration').value = data.settings.breakDuration;
            document.getElementById('settingWeekendOff').checked = data.settings.weekendOff;
            
            if (data.settings.primaryColor) {
                document.documentElement.style.setProperty('--primary-color', data.settings.primaryColor);
                document.querySelectorAll('#themeColorPicker .color-option').forEach(el => {
                    el.classList.toggle('selected', el.dataset.color === data.settings.primaryColor);
                });
            }
        }

        // ==================== Data Import/Export ====================
        function exportAllData() {
            const exportData = {
                ...data,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `cesme_kurs_yonetim_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Veriler dƒ±≈üa aktarƒ±ldƒ±!');
        }

        function importAllData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('Mevcut veriler silinecek ve i√ße aktarƒ±lan veriler y√ºklenecek. Devam etmek istiyor musunuz?')) {
                        data = {
                            courses: importedData.courses || [],
                            workshops: importedData.workshops || [],
                            teachers: importedData.teachers || [],
                            students: importedData.students || [],
                            schedules: importedData.schedules || [],
                            holidays: importedData.holidays || [],
                            categories: importedData.categories || data.categories,
                            settings: importedData.settings || data.settings
                        };
                        
                        saveData();
                        renderAll();
                        loadSettings();
                        showNotification('Veriler ba≈üarƒ±yla i√ße aktarƒ±ldƒ±!');
                    }
                } catch (error) {
                    showNotification('Dosya okunamadƒ±! Ge√ßerli bir JSON dosyasƒ± se√ßin.', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            if (confirm('T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Bu i≈ülem geri alƒ±namaz. Devam etmek istiyor musunuz?')) {
                if (confirm('Emin misiniz? T√ºm kurslar, √∂ƒürenciler, eƒüitmenler ve programlar silinecek!')) {
                    data = {
                        courses: [],
                        workshops: [],
                        teachers: [],
                        students: [],
                        schedules: [],
                        holidays: [],
                        categories: ['M√ºzik', 'Resim', 'El Sanatlarƒ±', 'Dans', 'Spor', 'Dil', 'Bilgisayar', 'Diƒüer'],
                        settings: {
                            orgName: '√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º',
                            startTime: '09:00',
                            endTime: '21:00',
                            lessonDuration: 60,
                            breakDuration: 15,
                            weekendOff: true,
                            primaryColor: '#1a5276'
                        }
                    };
                    
                    initializeDefaultHolidays();
                    saveData();
                    renderAll();
                    loadSettings();
                    showNotification('T√ºm veriler silindi!', 'warning');
                }
            }
        }

        // ==================== Filter Population ====================
        function populateFilters() {
            // Workshop filter
            const workshopFilter = document.getElementById('workshopFilter');
            if (workshopFilter) {
                workshopFilter.innerHTML = '<option value="">T√ºm At√∂lyeler</option>' +
                    data.workshops.filter(w => w.active).map(w => 
                        `<option value="${w.id}">${w.name}</option>`
                    ).join('');
            }
            
            // Teacher filter
            const teacherFilter = document.getElementById('teacherFilter');
            if (teacherFilter) {
                teacherFilter.innerHTML = '<option value="">T√ºm Eƒüitmenler</option>' +
                    data.teachers.filter(t => t.active).map(t => 
                        `<option value="${t.id}">${t.name}</option>`
                    ).join('');
            }
            
            // Course category filter
            const courseCategory = document.getElementById('courseCategory');
            if (courseCategory) {
                courseCategory.innerHTML = '<option value="">T√ºm Kategoriler</option>' +
                    data.categories.map(c => `<option value="${c}">${c}</option>`).join('');
            }
            
            // Student course filter
            const studentCourse = document.getElementById('studentCourse');
            if (studentCourse) {
                studentCourse.innerHTML = '<option value="">T√ºm Kurslar</option>' +
                    data.courses.filter(c => c.active).map(c => 
                        `<option value="${c.id}">${c.name}</option>`
                    ).join('');
            }
        }

        function populateSelectOptions() {
            updateReportOptions();
        }

        // ==================== Sample Data ====================
        function loadSampleData() {
            if (data.workshops.length === 0) {
                data.workshops = [
                    { id: 'w1', name: 'Ana Salon', location: 'Zemin Kat', capacity: 50, equipment: 'Projeksiyon, Ses Sistemi, Klima', color: '#3498db', active: true },
                    { id: 'w2', name: 'M√ºzik At√∂lyesi', location: '1. Kat', capacity: 20, equipment: 'Piyano, Ses Yalƒ±tƒ±mƒ±, Nota Sehpalarƒ±', color: '#9b59b6', active: true },
                    { id: 'w3', name: 'Resim At√∂lyesi', location: '2. Kat', capacity: 15, equipment: '≈û√∂vale, I≈üƒ±klandƒ±rma, Lavabo', color: '#27ae60', active: true },
                    { id: 'w4', name: 'Dans Salonu', location: 'Zemin Kat', capacity: 30, equipment: 'Ayna, Barre, Ses Sistemi', color: '#e74c3c', active: true },
                    { id: 'w5', name: 'El Sanatlarƒ± Odasƒ±', location: '1. Kat', capacity: 12, equipment: '√áalƒ±≈üma Masalarƒ±, Malzeme Dolabƒ±', color: '#f39c12', active: true }
                ];
            }
            
            if (data.teachers.length === 0) {
                data.teachers = [
                    { id: 't1', name: 'Ahmet Yƒ±lmaz', tc: '12345678901', branch: 'Baƒülama', phone: '0532 111 2233', email: 'ahmet@email.com', address: '√áe≈üme', notes: '', active: true },
                    { id: 't2', name: 'Ay≈üe Demir', tc: '12345678902', branch: 'Resim', phone: '0533 222 3344', email: 'ayse@email.com', address: '√áe≈üme', notes: '', active: true },
                    { id: 't3', name: 'Mehmet Kaya', tc: '12345678903', branch: 'Halk Danslarƒ±', phone: '0534 333 4455', email: 'mehmet@email.com', address: '√áe≈üme', notes: '', active: true },
                    { id: 't4', name: 'Fatma √ñz', tc: '12345678904', branch: 'Seramik', phone: '0535 444 5566', email: 'fatma@email.com', address: '√áe≈üme', notes: '', active: true },
                    { id: 't5', name: 'Ali √áelik', tc: '12345678905', branch: 'Gitar', phone: '0536 555 6677', email: 'ali@email.com', address: '√áe≈üme', notes: '', active: true }
                ];
            }
            
            if (data.courses.length === 0) {
                data.courses = [
                    { id: 'c1', name: 'Baƒülama Kursu', category: 'M√ºzik', duration: 16, capacity: 15, ageGroup: 'all', level: 'beginner', description: 'Temel baƒülama eƒüitimi', materials: 'Baƒülama (kendi enstr√ºmanƒ±)', active: true },
                    { id: 'c2', name: 'Yaƒülƒ± Boya Resim', category: 'Resim', duration: 12, capacity: 12, ageGroup: 'adult', level: 'intermediate', description: 'Yaƒülƒ± boya teknikleri', materials: 'Tuval, boya seti, fƒ±r√ßa', active: true },
                    { id: 'c3', name: 'Halk Danslarƒ±', category: 'Dans', duration: 20, capacity: 25, ageGroup: 'all', level: 'beginner', description: 'Ege y√∂resi halk danslarƒ±', materials: 'Rahat kƒ±yafet, dans ayakkabƒ±sƒ±', active: true },
                    { id: 'c4', name: 'Seramik At√∂lyesi', category: 'El Sanatlarƒ±', duration: 10, capacity: 10, ageGroup: 'adult', level: 'beginner', description: 'El yapƒ±mƒ± seramik', materials: '√ñnl√ºk', active: true },
                    { id: 'c5', name: '√áocuk Gitar Kursu', category: 'M√ºzik', duration: 12, capacity: 12, ageGroup: 'child', level: 'beginner', description: '√áocuklar i√ßin temel gitar', materials: '√áocuk gitarƒ±', active: true },
                    { id: 'c6', name: 'Ebru Sanatƒ±', category: 'El Sanatlarƒ±', duration: 8, capacity: 10, ageGroup: 'all', level: 'beginner', description: 'Geleneksel ebru teknikleri', materials: '√ñnl√ºk', active: true }
                ];
            }
            
            if (data.schedules.length === 0) {
                data.schedules = [
                    { id: 's1', courseId: 'c1', teacherId: 't1', workshopId: 'w2', day: '1', startTime: '10:00', endTime: '12:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's2', courseId: 'c1', teacherId: 't1', workshopId: 'w2', day: '3', startTime: '10:00', endTime: '12:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's3', courseId: 'c2', teacherId: 't2', workshopId: 'w3', day: '2', startTime: '14:00', endTime: '17:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's4', courseId: 'c2', teacherId: 't2', workshopId: 'w3', day: '4', startTime: '14:00', endTime: '17:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's5', courseId: 'c3', teacherId: 't3', workshopId: 'w4', day: '1', startTime: '18:00', endTime: '20:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's6', courseId: 'c3', teacherId: 't3', workshopId: 'w4', day: '3', startTime: '18:00', endTime: '20:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's7', courseId: 'c3', teacherId: 't3', workshopId: 'w4', day: '5', startTime: '18:00', endTime: '20:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's8', courseId: 'c4', teacherId: 't4', workshopId: 'w5', day: '2', startTime: '10:00', endTime: '13:00', startDate: '', endDate: '', notes: '', active: true },
                    { id: 's9', courseId: 'c5', teacherId: 't5', workshopId: 'w2', day: '6', startTime: '10:00', endTime: '12:00', startDate: '', endDate: '', notes: 'Hafta sonu kursu', active: true },
                    { id: 's10', courseId: 'c6', teacherId: 't4', workshopId: 'w5', day: '4', startTime: '10:00', endTime: '12:00', startDate: '', endDate: '', notes: '', active: true }
                ];
            }
            
            if (data.students.length === 0) {
                data.students = [
                    { id: 'st1', name: 'Zeynep Arslan', tc: '11111111111', birthdate: '1990-05-15', phone: '0541 111 1111', email: 'zeynep@email.com', address: '√áe≈üme Merkez', guardian: '', notes: '', courses: ['c1', 'c3'], registrationDate: '2024-01-15', active: true },
                    { id: 'st2', name: 'Emre Yƒ±ldƒ±z', tc: '22222222222', birthdate: '1985-08-20', phone: '0542 222 2222', email: 'emre@email.com', address: 'Ala√ßatƒ±', guardian: '', notes: '', courses: ['c2'], registrationDate: '2024-01-20', active: true },
                    { id: 'st3', name: 'Selin Korkmaz', tc: '33333333333', birthdate: '1995-03-10', phone: '0543 333 3333', email: 'selin@email.com', address: '√áe≈üme', guardian: '', notes: '', courses: ['c3', 'c4'], registrationDate: '2024-02-01', active: true },
                    { id: 'st4', name: 'Can √ñzt√ºrk', tc: '44444444444', birthdate: '2015-11-25', phone: '0544 444 4444', email: '', address: '√áe≈üme', guardian: 'Murat √ñzt√ºrk - 0544 444 4445', notes: '√áocuk √∂ƒürenci', courses: ['c5'], registrationDate: '2024-02-10', active: true },
                    { id: 'st5', name: 'Deniz Aydƒ±n', tc: '55555555555', birthdate: '1988-07-05', phone: '0545 555 5555', email: 'deniz@email.com', address: 'Ilƒ±ca', guardian: '', notes: '', courses: ['c1', 'c6'], registrationDate: '2024-02-15', active: true }
                ];
            }
            
            saveData();
            renderAll();
            showNotification('√ñrnek veriler y√ºklendi!');
        }

        // ==================== Keyboard Shortcuts ====================
        document.addEventListener('keydown', function(e) {
            // ESC to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
            
            // Ctrl+S to save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveData();
                showNotification('Veriler kaydedildi!');
            }
        });

        // ==================== Auto-save ====================
        setInterval(() => {
            saveData();
        }, 60000); // Auto-save every minute

        // ==================== Initialize on Load ====================
        window.addEventListener('load', function() {
            loadSettings();
            
            // Check if this is first run and offer to load sample data
            if (data.courses.length === 0 && data.workshops.length === 0) {
                setTimeout(() => {
                    if (confirm('Sistemde hen√ºz veri bulunmuyor. √ñrnek veriler y√ºklensin mi?')) {
                        loadSampleData();
                    }
                }, 500);
            }
        });

        // ==================== Service Worker for Offline Support ====================
        if ('serviceWorker' in navigator) {
            // Service worker can be added for offline support
            // navigator.serviceWorker.register('/sw.js');
        }

        // ==================== Drag and Drop for Schedule (Optional Enhancement) ====================
        function enableDragDrop() {
            // This can be implemented for drag-and-drop schedule management
            // Using HTML5 Drag and Drop API
        }

        // ==================== Print Schedule Function ====================
        function printSchedule() {
            const printContent = document.getElementById('weeklyOverview').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Haftalƒ±k Program - ${data.settings.orgName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { text-align: center; color: #1a5276; }
                        .weekly-schedule { 
                            display: grid; 
                            grid-template-columns: 80px repeat(7, 1fr); 
                            gap: 1px; 
                            background: #ddd; 
                        }
                        .schedule-header { 
                            background: #1a5276; 
                            color: white; 
                            padding: 8px; 
                            text-align: center; 
                            font-weight: bold; 
                        }
                        .schedule-time { 
                            background: #f5f5f5; 
                            padding: 8px; 
                            text-align: center; 
                        }
                        .schedule-cell { 
                            background: white; 
                            min-height: 40px; 
                            padding: 4px; 
                        }
                        .schedule-cell.weekend { 
                            background: #ffeaa7; 
                        }
                        .schedule-event { 
                            font-size: 10px; 
                            padding: 2px 4px; 
                            border-radius: 3px; 
                            margin-bottom: 2px; 
                            color: white;
                        }
                        @media print {
                            body { padding: 0; }
                            @page { size: landscape; }
                        }
                    </style>
                </head>
                <body>
                    <h1>${data.settings.orgName}</h1>
                    <h2 style="text-align: center;">Haftalƒ±k Ders Programƒ±</h2>
                    <p style="text-align: center;">Tarih: ${new Date().toLocaleDateString('tr-TR')}</p>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => printWindow.print(), 250);
        }

        // ==================== Conflict Checker ====================
        function checkAllConflicts() {
            const conflicts = [];
            
            data.schedules.forEach((s1, i) => {
                if (!s1.active) return;
                
                data.schedules.forEach((s2, j) => {
                    if (i >= j || !s2.active) return;
                    if (s1.day !== s2.day) return;
                    
                    // Check time overlap
                    const hasOverlap = (s1.startTime < s2.endTime && s1.endTime > s2.startTime);
                    
                    if (hasOverlap) {
                        // Same workshop conflict
                        if (s1.workshopId === s2.workshopId) {
                            const workshop = data.workshops.find(w => w.id === s1.workshopId);
                            conflicts.push({
                                type: 'At√∂lye √áakƒ±≈ümasƒ±',
                                detail: `${workshop?.name}: ${getDayName(parseInt(s1.day))} ${s1.startTime}-${s1.endTime} ile ${s2.startTime}-${s2.endTime}`
                            });
                        }
                        
                        // Same teacher conflict
                        if (s1.teacherId === s2.teacherId) {
                            const teacher = data.teachers.find(t => t.id === s1.teacherId);
                            conflicts.push({
                                type: 'Eƒüitmen √áakƒ±≈ümasƒ±',
                                detail: `${teacher?.name}: ${getDayName(parseInt(s1.day))} ${s1.startTime}-${s1.endTime} ile ${s2.startTime}-${s2.endTime}`
                            });
                        }
                    }
                });
            });
            
            if (conflicts.length === 0) {
                showNotification('√áakƒ±≈üma bulunamadƒ±! ‚úì');
            } else {
                let message = 'Bulunan √ßakƒ±≈ümalar:\n\n';
                conflicts.forEach(c => {
                    message += `${c.type}: ${c.detail}\n`;
                });
                alert(message);
            }
            
            return conflicts;
        }

        // ==================== Quick Add Buttons ====================
        function quickAddCourse() {
            openCourseModal();
        }

        function quickAddTeacher() {
            openTeacherModal();
        }

        function quickAddStudent() {
            openStudentModal();
        }

        function quickAddSchedule() {
            openScheduleModal();
        }

        // ==================== Statistics Calculations ====================
        function calculateStatistics() {
            const stats = {
                totalCourses: data.courses.length,
                activeCourses: data.courses.filter(c => c.active).length,
                totalStudents: data.students.length,
                activeStudents: data.students.filter(s => s.active).length,
                totalTeachers: data.teachers.length,
                activeTeachers: data.teachers.filter(t => t.active).length,
                totalWorkshops: data.workshops.length,
                activeWorkshops: data.workshops.filter(w => w.active).length,
                totalSchedules: data.schedules.length,
                activeSchedules: data.schedules.filter(s => s.active).length,
                weeklyHours: 0,
                avgStudentsPerCourse: 0,
                mostPopularCourse: null,
                busiestWorkshop: null,
                busiestTeacher: null
            };
            
            // Calculate weekly hours
            data.schedules.filter(s => s.active).forEach(s => {
                const start = parseInt(s.startTime.split(':')[0]);
                const end = parseInt(s.endTime.split(':')[0]);
                stats.weeklyHours += (end - start);
            });
            
            // Calculate average students per course
            const totalEnrolled = data.courses.reduce((sum, c) => {
                return sum + data.students.filter(s => s.courses && s.courses.includes(c.id)).length;
            }, 0);
            stats.avgStudentsPerCourse = stats.activeCourses > 0 ? 
                Math.round(totalEnrolled / stats.activeCourses * 10) / 10 : 0;
            
            // Find most popular course
            let maxStudents = 0;
            data.courses.forEach(c => {
                const count = data.students.filter(s => s.courses && s.courses.includes(c.id)).length;
                if (count > maxStudents) {
                    maxStudents = count;
                    stats.mostPopularCourse = c;
                }
            });
            
            // Find busiest workshop
            let maxSchedules = 0;
            data.workshops.forEach(w => {
                const count = data.schedules.filter(s => s.workshopId === w.id && s.active).length;
                if (count > maxSchedules) {
                    maxSchedules = count;
                    stats.busiestWorkshop = w;
                }
            });
            
            // Find busiest teacher
            maxSchedules = 0;
            data.teachers.forEach(t => {
                const count = data.schedules.filter(s => s.teacherId === t.id && s.active).length;
                if (count > maxSchedules) {
                    maxSchedules = count;
                    stats.busiestTeacher = t;
                }
            });
            
            return stats;
        }

        // ==================== Duplicate Schedule ====================
        function duplicateSchedule(id) {
            const original = data.schedules.find(s => s.id === id);
            if (!original) return;
            
            const duplicate = {
                ...original,
                id: generateId(),
                notes: (original.notes || '') + ' (Kopya)'
            };
            
            data.schedules.push(duplicate);
            saveData();
            renderAll();
            showNotification('Ders kopyalandƒ±! D√ºzenlemek i√ßin a√ßƒ±lƒ±yor...');
            editSchedule(duplicate.id);
        }

        // ==================== Bulk Operations ====================
        function bulkDeleteInactiveSchedules() {
            const inactiveCount = data.schedules.filter(s => !s.active).length;
            
            if (inactiveCount === 0) {
                showNotification('Pasif ders bulunamadƒ±!');
                return;
            }
            
            if (confirm(`${inactiveCount} pasif ders silinecek. Devam etmek istiyor musunuz?`)) {
                data.schedules = data.schedules.filter(s => s.active);
                saveData();
                renderAll();
                showNotification(`${inactiveCount} pasif ders silindi!`);
            }
        }

        function bulkActivateAllCourses() {
            let count = 0;
            data.courses.forEach(c => {
                if (!c.active) {
                    c.active = true;
                    count++;
                }
            });
            
            if (count > 0) {
                saveData();
                renderAll();
                showNotification(`${count} kurs aktif edildi!`);
            } else {
                showNotification('T√ºm kurslar zaten aktif!');
            }
        }

        // ==================== Date Range Filter for Schedules ====================
        function filterSchedulesByDateRange(startDate, endDate) {
            // This would filter schedules based on their start/end dates
            // Implementation depends on how recurring schedules are handled
            return data.schedules.filter(s => {
                if (!s.startDate && !s.endDate) return true; // No date restriction
                
                const schedStart = s.startDate ? new Date(s.startDate) : new Date('1970-01-01');
                const schedEnd = s.endDate ? new Date(s.endDate) : new Date('2099-12-31');
                const filterStart = new Date(startDate);
                const filterEnd = new Date(endDate);
                
                return schedStart <= filterEnd && schedEnd >= filterStart;
            });
        }

        // ==================== Initialize Complete ====================
        console.log('√áe≈üme Belediyesi K√ºlt√ºr M√ºd√ºrl√ºƒü√º - Kurs Y√∂netim Sistemi v1.0');
        console.log('Sistem hazƒ±r. Veriler localStorage\'da saklanmaktadƒ±r.');
    </script>
</body>
</html>